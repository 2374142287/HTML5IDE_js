function G(e){return document.getElementById(e)}function E(e,t,n){if(!t)t="load";if(!n)n=window;if(n.attachEvent){n.attachEvent("on"+t,e)}else{n.addEventListener(t,e,false)}}function json(s){try{return eval("("+s+")")}catch(e){return null}}function joinParam(e){if(!e||typeof e=="string")return e;var t="";for(var n in e)t+="&"+n+"="+encodeURIComponent(e[n]);if(t)t=t.substr(1);return t}function ajax(e){var t=/POST/i.test(e.type),n=e.data||"",r=e.dataType,i=e.url||location.href,s=/\?/.test(i)?"&":"?",o=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Msxml2.XMLHTTP")||new ActiveXObject("Microsoft.XMLHTTP"),u=function(n){if(o.readyState==4){if(o.status==200){n=o.responseText;if(r=="json")n=json(n);if(t=e.success)t(n)}else if(e.error){e.error(o.status,o)}}};o.onreadystatechange=u;if(typeof n=="object"){var a=[];for(var f in n)a.push(encodeURIComponent(f)+"="+encodeURIComponent(n[f]));n=a.join("&")}o.open(t?"POST":"GET",i+(t?"":(n?s:"")+n+(e.cache?"":(!n&&s=="?"?"?":"&")+"_="+(new Date).getTime())),e.async===false?false:true);if(t)o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");o.send(n);return o}function isMobile(){var e=navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i);return e?true:false}function fo(e){var t=0;var n=0;do{t+=e.offsetLeft||0;n+=e.offsetTop||0}while(e=e.offsetParent);return{x:t,y:n}}function fe(e){e=e||event;return{x:e.pageX||e.x,y:e.pageY||e.y}}function fc(e){if(e&&e.stopPropagation){e.stopPropagation()}else{event.cancelBubble=true}}function getClass(e,t){var n=new RegExp("(^|\\s*)"+e+"(\\s*|$)"),r=t?document.getElementsByTagName(t):document.getElementsByTagName("*")||document.all,i=[];for(var s=0,o=r.length;s<o;s++){if(n.test(r[s].className)){i.push(r[s])}}return i}function ptInRect(e,t,n,r,i,s,o){if(o){var u=o.getParam();var a=u.rotate;if(Math.abs(u.rotate)>.001){var f=o.getRotationCenter(false);var l=rotatePoint(f.x,f.y,e,t,-a);e=l.x;t=l.y}}var c=e>=n&&e<i&&t>=r&&t<s;return c}function rotatePoint(e,t,n,r,i){var s=n-e;var o=r-t;var u=Math.atan2(-o,s);var a=Math.sqrt(s*s+o*o);var f=u-i;var l=a*Math.cos(f);var c=a*Math.sin(f);return{x:e+l,y:t-c}}function getElementOffset(e){var t=0;var n=0;while(e.tagName!="BODY"){t+=e.offsetTop;n+=e.offsetLeft;e=e.offsetParent}return{top:t,left:n}}function getAniObject(e){return g_aniObj[e.guid]}function getAniObjectById(e){return g_aniObj[e]}function getGlobalAlpha(){return g_alpha}function getPathObject(e,t){if(!e||!e.path)return null;var n={guid:e.guidPath};var r;if(t==1){delete r;r=null}else if(t==2){r=null;n.guid=guidGen()}else r=getAniObject(n);if(!r){var i=createAniParam();i.guid=n.guid?n.guid:null;r=createNewObject(Hanimation.SHAPE_PATH,i.guid?i:null);if(!n.guid)e.guidPath=r.dataRef.guid;var s=createFillInfo();s.fillColors=[createColorStop(0,0,0,0,0)];r.dataRef.param.fillInfo=s;r.dataRef.param.lineWidth=1;r.setLayerFrame(e.layerId,e.frameStart)}r.dataRef.param.alpha=e.pathMode>Hanimation.PATHMODE_DEFAULT?1:.5;r.dataRef.param.strokeColor=e.pathMode>Hanimation.PATHMODE_DEFAULT?"#FF00FF":"#333333";return r}function getColor(e){if(!e)e="#000000";var t=e.toLowerCase();var n="#000000";var r=t.indexOf("rgb");if(r==0)n=e;else{var i=new RGBColor(t);n=i.toRGB()}return n}function getIncrementalId(){return g_nId++}function S4(){return((1+Math.random())*65536|0).toString(16).substring(1)}function guidGen(){var e=(new Date).getTime();if(e<=g_prevTime)e=g_prevTime+1;g_prevTime=e;var t=e-(new Date("2013/1/1")).getTime()+""+Math.random().toString().substr(2,4);return Number(t).toString(36)}function RGBColor(e){this.ok=false;if(e.charAt(0)=="#"){e=e.substr(1,6)}e=e.replace(/ /g,"");e=e.toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var n in t){if(e==n){e=t[n]}}var r=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}];for(var i=0;i<r.length;i++){var s=r[i].re;var o=r[i].process;var u=s.exec(e);if(u){channels=o(u);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true}}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r;this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g;this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b;this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};this.toHex=function(){var e=this.r.toString(16);var t=this.g.toString(16);var n=this.b.toString(16);if(e.length==1)e="0"+e;if(t.length==1)t="0"+t;if(n.length==1)n="0"+n;return"#"+e+t+n};this.getHelpXML=function(){var e=new Array;for(var n=0;n<r.length;n++){var i=r[n].example;for(var s=0;s<i.length;s++){e[e.length]=i[s]}}for(var o in t){e[e.length]=o}var u=document.createElement("ul");u.setAttribute("id","rgbcolor-examples");for(var n=0;n<e.length;n++){try{var a=document.createElement("li");var f=new RGBColor(e[n]);var l=document.createElement("div");l.style.cssText="margin: 3px; "+"border: 1px solid black; "+"background:"+f.toHex()+"; "+"color:"+f.toHex();l.appendChild(document.createTextNode("test"));var c=document.createTextNode(" "+e[n]+" -> "+f.toRGB()+" -> "+f.toHex());a.appendChild(l);a.appendChild(c);u.appendChild(a)}catch(h){}}return u}}function createFillPattern(e,t,n,r){var i="#93C9FF";var s;var o;var n=n||1;var r=r||1;if(t.fillStyle==0){var u=t.fillColors[0];i="rgba("+u.r+","+u.g+","+u.b+","+u.a+")"}else if(t.fillStyle==1){i=e.createLinearGradient(t.fillStartPos.x*n,t.fillStartPos.y*r,t.fillEndPos.x*n,t.fillEndPos.y*r);for(s=0;s<t.fillColors.length;s++){o=t.fillColors[s];i.addColorStop(o.p,"rgba("+o.r+","+o.g+","+o.b+","+o.a+")")}}else if(t.fillStyle==2){var a=Math.abs(t.fillEndPos.x-t.fillStartPos.x)*n,f=Math.abs(t.fillEndPos.y-t.fillStartPos.y)*r,l=Math.sqrt(a*a+f*f);i=e.createRadialGradient(t.fillStartPos.x*n,t.fillStartPos.y*r,0,t.fillStartPos.x*n,t.fillStartPos.y*r,l);for(s=0;s<t.fillColors.length;s++){o=t.fillColors[s];i.addColorStop(o.p,"rgba("+o.r+","+o.g+","+o.b+","+o.a+")")}}else if(t.fillStyle==3){var c=new Image;c.src=t.fillImage;i=e.createPattern(c,"repeat")}else if(t.fillStyle==4){i="rgba(255,255,255,0)"}return i}function createNewObject(e,t){var n=t?t:createAniParam();var r=null;switch(e){case Hanimation.SHAPE_LINE:r=new Hanimation.BLine(n);break;case Hanimation.SHAPE_RECTANGLE:r=new Hanimation.BRectangle(n);break;case Hanimation.SHAPE_POLYGON:r=new Hanimation.Polygon(n);break;case Hanimation.SHAPE_ROUNDED:r=new Hanimation.BRounded(n);break;case Hanimation.SHAPE_CURVE:r=new Hanimation.Curve(n);break;case Hanimation.SHAPE_SPLINE:r=new Hanimation.Spline(n);break;case Hanimation.SHAPE_PENCIL:r=new Hanimation.Pencil(n);break;case Hanimation.SHAPE_PICTURE:r=new Hanimation.Picture(n);break;case Hanimation.SHAPE_CAMERA:r=new Hanimation.Camera(n);break;case Hanimation.SHAPE_PATH:r=new Hanimation.Path(n);break;case Hanimation.SHAPE_TEXT:r=new Hanimation.Text(n);break;case Hanimation.SHAPE_ELLIPSE:r=new Hanimation.BEllipse(n);break;case Hanimation.SHAPE_SELECT:r=new Hanimation.Select(n);break;case Hanimation.SHAPE_GROUP:r=new Hanimation.Group(n);break;case Hanimation.SHAPE_CLIP:r=new Hanimation.Clip(n);break;case Hanimation.SHAPE_NODE:case Hanimation.SHAPE_SCALE:default:break}if(r){if(g_aniObj[n.guid])delete g_aniObj[n.guid];g_aniObj[n.guid]=r}return r}function duplicateObject(e,t,n,r,i){var s=createNewObject(e.type,r?e:null);if(e.items&&e.items.length){for(var o=0;o<e.items.length;o++){var u=e.items[o];var a=null;if(u.items&&u.items.length)a=duplicateObject(u,t,n,r,i);else{a=createNewObject(u.type,r?u:null);a.copyData(u);a.setLayerFrame(t,n);Mugeda.setIdName(a.dataRef,a.dataRef.param.name,i);if(!r&&u.type==Hanimation.SHAPE_PICTURE){var f=ImageCache.getImage(u.guid);if(f)ImageCache.updateImage(a.dataRef.guid,f)}}s.addObject(a)}s.dataRef.param=JSON.clone(e.param);Mugeda.setIdName(s.dataRef,s.dataRef.param.name,i)}else{s.copyData(e);s.setLayerFrame(t,n);Mugeda.setIdName(s.dataRef,s.dataRef.param.name,i);if(!r&&e.type==Hanimation.SHAPE_PICTURE){var f=ImageCache.getImage(e.guid);if(f)ImageCache.updateImage(s.dataRef.guid,f)}}return s}function getClearSpace(e){var t;var n;var r=[];var i=[];var s=[];for(var o=0;o<e.length;o++){t=e[o].param;r.push(t.left);r.push(t.right);i.push(t.top);i.push(t.bottom);s.push(t.lineWidth/2)}n={left:Math.min.apply(Math,r),right:Math.max.apply(Math,r),top:Math.min.apply(Math,i),bottom:Math.max.apply(Math,i),off:Math.max.apply(Math,s)+4};n.width=n.right-n.left;n.height=n.bottom-n.top;return n}function getThumbnail(e,t){var n;var r;var i;n=getClearSpace(e);n.width+=n.off*2;n.height+=n.off*2;r=G("canvasBuffer");if(r){r.width=n.width;r.height=n.height;r.style.width=n.width+"px";r.style.height=n.height+"px";redrawCanvas({canvas:r,objects:e,preview:true,offset:{x:n.left-n.off,y:n.top-n.off}});i=new Image;i.src=r.toDataURL("image/png");i.onload=function(){if(t)t(this)};i.onerror=function(){this.src=this.src=="res/noimage.png"?Mugeda.emptyImg:"res/noimage.png";if(t)t(this)};r.getContext("2d").clearRect(0,0,r.offsetWidth,r.offsetHeight)}else{if(t)t(this)}}function drawCanvasThumbnail(e,t){var n=t.getContext("2d");var r={w:e.width,h:e.height};var i={w:t.width,h:t.height};var s,o,u,a;if(r.w/r.h>i.w/i.h){s=e.width;o=i.h*s/i.w;a=0;u=(o-e.height)/2}else{o=e.height;s=i.w*o/i.h;u=0;a=(s-e.width)/2}t.width=s;t.height=o;n.clearRect(0,0,s,o);n.drawImage(e,0,0,e.width,e.height,a,u,e.width,e.height);t.style.width=i.w+"px";t.style.height=i.h+"px"}function getTweenFactors(count,type){var factors=[];var position={x:0};var tween=new TWEEN.Tween(position);tween.to({x:1},1e3);if(!type)type="Quartic.EaseOut";tween.easing(eval("TWEEN.Easing."+type));for(var i=0;i<count;i++)factors[i]=tween.getFactor(i/count);return factors}function prepareCanvasRotation(e,t,n){var r=-t.rotation;var i={scaleX:t.zoomLevel,scaleY:t.zoomLevel};if(r!=0){var s=Math.sqrt(n.width*n.width+n.height*n.height)/2;var o=r;var u=Math.atan2(n.height,n.width);var a=s*Math.cos(o+u);var f=s*Math.sin(o+u);var l=n.width/2-a;var c=n.height/2-f;e.translate(l,c);e.rotate(r)}}function redrawCanvas(e){if(!e)e={};var t;var n;var r=window.currentFrame;var i=e.canvas;if(e.aniData){window.aniData=e.aniData;if(!e.color)e.color=window.aniData.color;if(!e.layers)e.layers=window.aniData.layers;if(e.frameId!=undefined)r=e.frameId}if(i.width!=i.offsetWidth||i.height!=i.offsetHeight){i.width=i.offsetWidth;i.height=i.offsetHeight}t=i.getContext("2d");t.clearRect(0,0,i.width,i.height);if(e.color){i.bkColor=e.color;i.style.backgroundColor=e.color}if(e.clear)return;if(e.repair&&!built){built=true;e.layers=buildLayers(e.layers)}if(!e.objects){for(var s=e.layers.length-1;s>=0;s--){var o=e.layers[s];o.objs=[];var u=o.units.length;for(var a=0;a<u;a++){var f=o.units[a];var l=f.objects.length;if(f&&r>=f.frameStart&&r<f.frameStart+f.frameCount){o.unit=f;if(f.audio&&!e.silent){var c="l"+s+"u"+a;if(r==f.frameStart){var h=AudioCache.getAudio(f.id);if(h){if(h.currentTime)h.currentTime=0;try{h.play()}catch(p){}}if(Hanimation.AudioCallback)Hanimation.AudioCallback(c,f.audio,r,Hanimation.AUDIO_START)}else if(r==f.frameStart+f.frameCount-1){var h=AudioCache.getAudio(f.id);if(h){try{h.pause()}catch(p){}}if(Hanimation.AudioCallback)Hanimation.AudioCallback(c,f.audio,r,Hanimation.AUDIO_STOP)}}if(l){for(var d=0;d<l;d++){objData=f.objects[d];n=getAniObject(objData);Mugeda.processObjectBehavior(n,"appear");if(f.animated&&l==1){var v=TimelineUnit.getKeyframe(f,r);var m=f.objects[d].param;if(v){var g=v;Param.exchange(v.param,objData.param,true)}else{var y=TimelineUnit.getTweenParam(f,r,m);if(y){Param.exchange(y,m,true)}if(y)Param.exchange(y,objData.param,true)}}else if(f.pg&&(n.progressMode==4||n.progressMode==5)){var y=TimelineUnit.getProgressParam(f,n,r,{tween:"Elastic.EaseOut"});if(y){Param.exchange(y,objData.param,true)}}else if(!f.animated)TimelineUnit.distributeProgress(f);o.objs.push(f.objects[d])}}}}}}t.save();var b=null;var w=this.prevZoomInfo;if(!w)w=Zoom.getZoomInfo(window.aniData,-1);var E=window.aniData.zoomInfo.length;if(e.preview)b=Zoom.getZoomInfo(window.aniData,-1);else if(r==0||E==1){b=window.aniData.zoomInfo[1];if(!b){b={zoomLevel:1,offsetLeft:0,offsetTop:0,rotation:0};if(E>1)window.aniData.zoomInfo[1]=b}}else b=Zoom.getZoomInfo(window.aniData,r);if(w){var S=b.zoomLevel/w.zoomLevel;if(w.offsetLeft!=b.offsetLeft||w.offsetTop!=b.offsetTop||Math.abs(S-1)>.001)Zoom.updateLayersAfterZoom(window.aniLayers,S)}this.prevZoomInfo=JSON.clone(b);prepareCanvasRotation(t,b,window.aniData);t.translate(-b.offsetLeft*b.zoomLevel,-b.offsetTop*b.zoomLevel);if(e.offset)t.translate(-e.offset.x,-e.offset.y);if(e.objects){for(var s=0;s<e.objects.length;s++){n=e.objects[s];n=getAniObject(n);n.draw(t,0)}}else{HaniMask.drawLayer(t,e.layers,b)}t.restore()}function loadObjectImage(e,t,n){var r=0;if(!e)return 0;if(e.items&&e.items.length){for(var i=0;i<e.items.length;i++)r+=loadObjectImage(e.items[i],t,n)}else if(e.type==Hanimation.SHAPE_PICTURE&&e.param.imageSrc.length>0){r++;var s=new Image;s.src=e.param.imageSrc;s.object=e;s.guid=e.guid;s.onload=t;s.onerror=n}return r}function isDefined(e){return typeof e=="undefined"?false:true}function updateAnimationPath(e){function y(e,t){var n=null;var r=e.length;for(var i=0;i<r;i++){D=e[i];if(D.id==t){n=D;break}}return n}function b(t){var r=n.length;var s=null;for(var o=0;o<i;o++){var u=e.keyframes[o];if(u.nodeId==t){s=u;break}}return s}if(!e)return;var t=typeof e.pathMode=="undefined"?Hanimation.PATHMODE_DEFAULT:e.pathMode;if(!e.animated)return;var n=[];var r=[];var i=e.keyframes.length;var s,o,u,a,f,l,c;var h,p,d;var v,m,g;var w=t!=Hanimation.PATHMODE_UPDATE_KEYFRAME;for(var E=0;E<i;E++){var S=e.keyframes[E];s=S.param;o=s.left+s.rotateCenterX;u=s.top+s.rotateCenterY;if(t==1){if(E<i-1){var x=e.keyframes[E+1];h=x.param;p=h.left+h.rotateCenterX;d=h.top+h.rotateCenterY}else{var T=e.keyframes[E-1];v=T.param;m=v.left+v.rotateCenterX;g=v.top+v.rotateCenterY;p=2*o-m;d=2*u-g}if(E>0){var T=e.keyframes[E-1];v=T.param;m=v.left+v.rotateCenterX;g=v.top+v.rotateCenterY}else{var x=e.keyframes[E+1];h=x.param;p=h.left+h.rotateCenterX;d=h.top+h.rotateCenterY;m=2*o-p;g=2*u-d}var N=.2;a=o+N*(p-o);f=u+N*(d-u);l=o+N*(m-o);c=u+N*(g-u)}else if(t==0){a=o;f=u;l=o;c=u}else if(t==2){var C=getPathObject(e);if(!C)continue;if(typeof S.nodeId=="undefined"){var k=E<i-1?E+1:E;var L=E>0?E-1:0;var A=e.keyframes[k];var O=e.keyframes[L];var M=Math.abs(A.id-O.id);var _=S.id-O.id;var N=_/M;n=C.dataRef.curve.points;Bezier.subDivision2(n,L,N);w=false;D=n[E];D.id=getIncrementalId();S.nodeId=D.id;r[S.nodeId]=S.id;syncAnimationPath(e,C)}else r[S.nodeId]=S.id;var D=y(e.path,S.nodeId);if(!D)continue;var P=C.getParam();var H=o-D.nodeX-P.left;var B=u-D.nodeY-P.top;D.nodeX+=H;D.nodeY+=B;D.forwardX+=H;D.forwardY+=B;D.backwardX+=H;D.backwardY+=B}else if(t==3){var C=getPathObject(e);if(C){n=C.dataRef.curve.points;var P=C.getParam();var j=n.length;for(var F=j-1;F>=0;F--){var D=n[F];var I=b(D.id);if(I){var q=I.param;Param.shift(q,P.left+D.nodeX-q.rotateCenterX-q.left,P.top+D.nodeY-q.rotateCenterY-q.top)}else{n.splice(F,1)}}}}if(t<2){var D=createTriPoint(o,u,a,f,l,c);D.id=getIncrementalId();n.push(D);S.nodeId=D.id}}var R=true;if(t<2){if(e.path)delete e.path;e.path=n.slice(0);R=false}{var C=getPathObject(e);if(C){if(t==2){var n=e.path;var U=n.length;for(var F=U-1;F>=0;F--){if(r[n[F].id]==undefined){n.splice(F,1)}}}if(w){var s=C.getParam();if(!R){s.left=0;s.top=0;s.startX=0;s.startY=0}C.dataRef.curve.points=[];C.addPoints(e.path,false)}syncAnimationPath(e,C)}}}function buildLayers(e,t){var n=[];if(!e)e=window.aniLayers;for(var r=0;r<e.length;r++){var i=JSON.clone(e[r]);i.units=[];var s=e[r].units;var o=[];var u=0;for(var a=0;a<s.length;a++){var f=s[a];if(f.frameStart>u){continue}u=f.frameStart+f.frameCount;var l=JSON.clone(f);if(l.id==undefined)l.id=guidGen();var c=l.id.toString();if(c.length<4)l.id=guidGen();if(o[l.id]){var h=l.id+999;while(o[h])h++;l.id=h}o[l.id]=l.id;l.objects=[];var p=l.keyframes.length;for(var d=0;d<p;d++){var v=l.keyframes[d];if(d==0&&v.id!=f.frameStart){v.id=f.frameStart}l.hashKey["key_"+v.id]=v}if(l.path&&l.animated){var m=getPathObject(l,1);if(m){m.dataRef.curve.points=[];m.addPoints(l.path,false);var g=m.dataRef.param;g.left+=l.pathLeft;g.top+=l.pathTop;g.right+=l.pathLeft;g.bottom+=l.pathTop;g.startX=g.left;g.startY=g.top;g.endX=g.right;g.endY=g.bottom}if(l.pathMode==Hanimation.PATHMODE_UPDATE_PATH)l.pathMode=Hanimation.PATHMODE_UPDATE_KEYFRAME;updateAnimationPath(l)}var y=f.objects;for(var b=0;b<y.length;b++){var w=y[b];obj=duplicateObject(w,i.id,f.frameStart,true,2);TimelineUnit.addObject(l,obj,true,e)}i.units.push(l)}n.push(i)}e=n;return e}function syncAnimationPath(e,t){if(e&&t){var n=t.getParam();e.path=t.dataRef.curve.points.slice(0);e.pathLeft=n.left;e.pathTop=n.top}}function bezierInterpolate(e,t,n,r,i,s){var o=Math.pow(t,3)*n+3*Math.pow(t,2)*e*r+3*t*Math.pow(e,2)*i+Math.pow(e,3)*s;return o}function bezierGetPoint(e,t,n){var r=1-n;var i=e.nodeX;var s=e.nodeY;var o=e.forwardX;var u=e.forwardY;var a=t.backwardX;var f=t.backwardY;var l=t.nodeX;var c=t.nodeY;var h=bezierInterpolate(n,r,i,o,a,l);var p=bezierInterpolate(n,r,s,u,f,c);return{x:h,y:p}}function compressAniData(e){return MugedaCompress.zip(e)}function uncompressAniData(e){var t=MugedaCompress.unzip(e);if(t.script&&t.script.length)t.script=unescape(t.script);return t}JSON.clone=function(e){return JSON.parse(JSON.stringify(e))};var g_aniObj=[];var g_alpha=1;createTriPoint=function(e,t,n,r,i,s){var o={nodeX:e?e:0,nodeY:t?t:0,forwardX:n?n:0,forwardY:r?r:0,backwardX:i?i:0,backwardY:s?s:0};return o};createPoint=function(e,t){var n={x:e?e:0,y:t?t:0};return n};if(typeof Hanimation=="undefined"){var Hanimation={}}Hanimation.MRAID_READY=1;Hanimation.LoadURL="../../myani/load";Hanimation.SHAPE=2e3;Hanimation.SHAPE_LINE=Hanimation.SHAPE+1;Hanimation.SHAPE_CURVE=Hanimation.SHAPE+2;Hanimation.SHAPE_RECTANGLE=Hanimation.SHAPE+3;Hanimation.SHAPE_ELLIPSE=Hanimation.SHAPE+4;Hanimation.SHAPE_PICTURE=Hanimation.SHAPE+5;Hanimation.SHAPE_POLYGON=Hanimation.SHAPE+6;Hanimation.SHAPE_SELECT=Hanimation.SHAPE+7;Hanimation.SHAPE_SCALE=Hanimation.SHAPE+8;Hanimation.SHAPE_ROUNDED=Hanimation.SHAPE+9;Hanimation.SHAPE_TEXT=Hanimation.SHAPE+10;Hanimation.SHAPE_BSHAPE=Hanimation.SHAPE+11;Hanimation.SHAPE_PROPERTY=Hanimation.SHAPE+12;Hanimation.SHAPE_NODE=Hanimation.SHAPE+13;Hanimation.SHAPE_GROUP=Hanimation.SHAPE+14;Hanimation.SHAPE_SPLINE=Hanimation.SHAPE+15;Hanimation.SHAPE_ZOOM=Hanimation.SHAPE+16;Hanimation.SHAPE_CAMERA=Hanimation.SHAPE+17;Hanimation.SHAPE_PATH=Hanimation.SHAPE+18;Hanimation.SHAPE_PENCIL=Hanimation.SHAPE+19;Hanimation.SHAPE_AUDIO=Hanimation.SHAPE+20;Hanimation.SHAPE_CLIP=Hanimation.SHAPE+21;Hanimation.SHAPE_VIDEO=Hanimation.SHAPE+22;Hanimation.AUDIO=4e3;Hanimation.AUDIO_START=Hanimation.AUDIO+1;Hanimation.AUDIO_STOP=Hanimation.AUDIO+2;Hanimation.AudioCallback=null;Hanimation.MAX_VALUE=99999999;Hanimation.MIN_VALUE=-99999999;Hanimation.HITTEST=3e3;Hanimation.HITTEST_LEFTTOP=Hanimation.HITTEST+1;Hanimation.HITTEST_TOP=Hanimation.HITTEST+2;Hanimation.HITTEST_RIGHTTOP=Hanimation.HITTEST+3;Hanimation.HITTEST_LEFT=Hanimation.HITTEST+4;Hanimation.HITTEST_PIVOT=Hanimation.HITTEST+5;Hanimation.HITTEST_RIGHT=Hanimation.HITTEST+6;Hanimation.HITTEST_LEFTBOTTOM=Hanimation.HITTEST+7;Hanimation.HITTEST_BOTTOM=Hanimation.HITTEST+8;Hanimation.HITTEST_RIGHTBOTTOM=Hanimation.HITTEST+9;Hanimation.HITTEST_WITHIN=Hanimation.HITTEST+10;Hanimation.HITTEST_ROTATE=Hanimation.HITTEST+11;Hanimation.HITTEST_NONE=Hanimation.HITTEST+12;Hanimation.HITTEST_CONTROL=Hanimation.HITTEST+13;Hanimation.HITTEST_FILLSTART=Hanimation.HITTEST+14;Hanimation.HITTEST_FILLEND=Hanimation.HITTEST+15;Hanimation.PATHMODE_DEFAULT=0;Hanimation.PATHMODE_CUSTOM=1;Hanimation.PATHMODE_UPDATE_PATH=2;Hanimation.PATHMODE_UPDATE_KEYFRAME=3;Hanimation.UNIT_MODE_PROGRESS=1;if(!Hanimation.Message)Hanimation.Message={};Hanimation.Message.ImageError="There are errors in loading image data. Your animation may not be rendered correctly.";Hanimation.Message.CheckNull="Invalid field (empty)";Hanimation.Message.CheckNumber="Invalid number";Hanimation.Message.CheckEmail="Invalid email";Hanimation.Message.CheckUrl="Invalid url";Hanimation.MugedaTrackAnchors=[];Hanimation.MugedaActionTracker=[];HaniData={zip:function(e){return this.unzip(e,true)},unzip:function(e,t){var n=e.layers;for(var r=n.length-1;r>=0;r--){var i=n[r];var s=i.units;for(var o=0;o<s.length;o++){var u=s[o];var a=u.objects;for(var f=0;f<a.length;f++){this.fobjs(a[f],t)}}}return e},fobjs:function(e,t){if(e.items&&e.items.length){for(var n=0;n<e.items.length;n++){var r=e.items[n];if(r.items&&r.items.length){this.fobjs(r,t)}else{this.fobj(r,t)}}}else{this.fobj(e,t)}},fobj:function(e,t){var n=e.curve.points;var r=n.length;if(!r)return;var i;var s=[];var o=typeof n=="string";var u=e.type!=Hanimation.SHAPE_SPLINE;if(t){if(o)return;for(var a=0;a<r;a++){i=n[a];i=u?[i.backwardX,i.backwardY,i.forwardX,i.forwardY,i.nodeX,i.nodeY]:[i.x,i.y];s.push(i.join(","))}s=s.join(";")}else{if(!o)return;n=n.split(";");for(var a=0;a<n.length;a++){i=n[a].split(",");i=u?{backwardX:Number(i[0]),backwardY:Number(i[1]),forwardX:Number(i[2]),forwardY:Number(i[3]),nodeX:Number(i[4]),nodeY:Number(i[5])}:{x:Number(i[0]),y:Number(i[1])};s.push(i)}}e.curve.points=s}};createColorStop=function(e,t,n,r,i){return{p:e,r:t,g:n,b:r,a:i}};createFillInfo=function(){var e={fillStyle:0,fillImage:"",fillStartPos:{x:32,y:10},fillEndPos:{x:80,y:100},fillColors:[createColorStop(0,144,200,255,1),createColorStop(.8,255,144,200,1),createColorStop(1,200,255,144,1)]};return e};var g_nId=0;var g_prevTime=0;createParam=function(){var e={left:0,top:0,right:0,bottom:0,startX:0,startY:0,endX:0,endY:0,width:0,height:0,alpha:1,rotate:0,scaleX:1,scaleY:1,lineWidth:1,strokeType:0,strokeColor:"#0683ff",lineCap:"round",lineJoin:"round",fillInfo:createFillInfo()};return e};createAniParam=function(){var e=createParam();var t={guid:guidGen(),id:0,type:0,name:"",param:{}};var n={closed:1,points:[]};t.curve=n;t.param=e;return t};TimelineUnit={addObject:function(e,t,n,r,i){layers=window.aniLayers;if(typeof r!="undefined")layers=r;if(layers){for(var s=layers.length-1;s>=0;s--){if(layers[s].id==e.layerId)break}if(s<0)return;var o=layers[s];if(!n&&o&&(o.lock||o.hide)){alert(Hanimation.Message.LockedLayer);return false}}if(e.animated&&e.objects.length>0){alert(Hanimation.Message.LockedUnit);return false}if(t){if(!i)e.objects.push(t.dataRef);else{var u=e.objects.length;for(var a=0;a<u;a++){var f=e.objects[a];if(f==i){e.objects.splice(a+1,0,t);break}}e.objects.push(t.dataRef)}t.setLayerFrame(e.layerId,e.frameStart)}return true},distributeProgress:function(e,t){function n(e){var t=0;switch(e.type){case Hanimation.SHAPE_PENCIL:t=1;break;case Hanimation.SHAPE_CURVE:case Hanimation.SHAPE_RECTANGLE:case Hanimation.SHAPE_ELLIPSE:case Hanimation.SHAPE_POLYGON:case Hanimation.SHAPE_ROUNDED:case Hanimation.SHAPE_LINE:t=2;break;case Hanimation.SHAPE_TEXT:t=3;break;case Hanimation.SHAPE_PICTURE:case Hanimation.SHAPE_GROUP:t=4;break}return t}if(!e||e.animated||!e.pg)return;var r=e.frameCount;var i=0;var s=e.objects.length;var o=2;var u=0;var a=1;var f=window.aniData.rate;{for(var l=0;l<s;l++){var c=e.objects[l];var h=getAniObject(c);h.progressMode=n(c);if(h.progressMode==1){i+=c.curve.points.length}else if(h.progressMode==2){var p=c.curve.points.length+(c.curve.closed?1:0);i+=p<<o}else if(h.progressMode==3){var d=unescape(c.param.textContent).length;i+=d<<u}else if(h.progressMode==4||h.progressMode==5){i+=f*a}}e.totalNodes=i;var v=0;for(l=0;l<s;l++){var c=e.objects[l];var h=getAniObject(c);if(h.progressMode){var h=getAniObject(c);h.percentFrom=v/i;var p=c.curve.points.length+(c.curve.closed?1:0);if(h.progressMode==1)v+=p;else if(h.progressMode==2)v+=p<<o;else if(h.progressMode==3){var d=unescape(c.param.textContent).length;v+=d<<u}else if(h.progressMode==4||h.progressMode==5){if(h.anchorParam)c.param=JSON.clone(h.anchorParam);else h.anchorParam=JSON.clone(c.param);v+=f*a}h.percentTo=v/i}}}var m=window.currentFrame-e.frameStart+1;for(var l=0;l<s;l++){var c=e.objects[l];var h=getAniObject(c);if(h.progressMode){h.framePercent=t==1?1:m/r}}},setAnimated:function(e,t){e.pg=false;if(e.animated==t)return;e.animated=t;if(!t){if(e.objects.length&&e.objects[0].type==Hanimation.SHAPE_GROUP){var n=e.keyframes.length;for(var r=n-1;r>0;r--){var i=e.keyframes[r];if(i){if(e.hashKey["key_"+i.id])delete e.hashKey["key_"+i.id];delete i}e.keyframes.splice(r,1)}e.keyframes.length=1}}else if(e.objects.length){if(e.objects.length>1||e.objects[0].type!=Hanimation.SHAPE_GROUP){var s=createNewObject(Hanimation.SHAPE_GROUP);s.addObjects(e.objects);s.getRawBound();e.objects=[];TimelineUnit.addObject(e,s)}if(e.keyframes.length==1)this.addKeyframe(e,e.frameStart+e.frameCount-1)}else{alert(Hanimation.Message.NoObject);e.animated=false}},setProgress:function(e,t){if(e.animated){alert(Hanimation.Message.NoProgress);return}if(e.pg==t)return;e.pg=t},addKeyframe:function(e,t){if(!isDefined(t))return null;var n=e.keyframes.length;var r;if(e.animated==false||n==0)r=null;else{r=createParam();var i=getAniObject(e.objects[0]);if(n==1){Param.exchange(r,e.objects[0].param,false);Param.exchange(e.keyframes[0].param,r,false)}else if(t>e.keyframes[n-1].id){Param.exchange(r,e.keyframes[n-1].param,false)}else{r=this.getTweenParam(e,t)}}var s=createKeyframe(t,r);if(n==0){e.keyframes.push(s)}else{for(var o=n-1;o>=0;o--){if(t>e.keyframes[o].id){e.keyframes.splice(o+1,0,s);break}}}e.hashKey["key_"+t]=s;return s},deleteKeyframe:function(e,t){},getKeyframe:function(e,t){var n=e.hashKey["key_"+t];if(!n)n=null;return n},repairKeyframe:function(e,t,n){for(var r=e.keyframes.length-1;r>=0;r--){var i=e.keyframes[r];if(i.id<t)break;var s="key_"+i.id;var o=e.hashKey[s];delete e.hashKey[s];i.id=i.id+n;e.hashKey["key_"+i.id]=o}var u=e.objects.length;for(var r=0;r<u;r++){var a=e.objects[r];var f=getAniObject(a);if(f){f.frameId=e.frameStart;f.layerId=e.layerId}}},findKeyframe:function(e,t){var n=e.keyframes.length;var r=null;var i=null;var s=null;for(var o=0;o<n;o++){r=e.keyframes[o];if(r.id==t){s=r;break}}return s},getProgressParam:function(e,t,n,r){if(!(e&&t&&t.anchorParam))return t?t.getParam():null;var i=r.tween;var s=e.frameStart+Math.floor(e.frameCount*t.percentFrom);var o=e.frameStart+Math.floor(e.frameCount*t.percentTo)-1;var u=o-s+1;var a=Math.min(o,n-s);var f=t.anchorParam;var l=JSON.clone(f);{var c=.5;l.rotate=f.rotate-Math.PI*.25;l.scaleX=f.scaleX*c;l.scaleY=f.scaleY*c;l.alpha=a<0?0:f.alpha*c;l.startX=f.startX+f.rotateCenterX*(1-c);l.startY=f.startY+f.rotateCenterY*(1-c);l.width=f.width*c;l.height=f.height*c;l.endX=l.startX+l.width;l.endY=l.startY+l.height;l.rotateCenterX=f.rotateCenterX*c;l.rotateCenterY=f.rotateCenterY*c;l.customPivot=true;l.left=l.startX;l.top=l.startY;l.right=l.startX+l.width;l.bottom=l.startY+l.height}var h=this.getTweenFactors(u,i)[a<0?0:a];var p=createParam();Param.tweenParam(p,l,f,h);return p},getTweenParam:function(e,t,n){var r=e.keyframes.length;var i=e.keyframes[0];var s=null;var o=null;var u=0;var a=-1;if(r>1&&!e.hashKey["key_"+t]){for(var f=1;f<r;f++){s=e.keyframes[f];if(s.id>t){a=f;break}i=s;u=f;s=null}if(s){var l=Math.abs(s.id-i.id);var c=t-i.id;var h=this.getTweenFactors(l,i.tween)[c];o=createParam();Param.tweenParam(o,i.param,s.param,h);if(e.pathMode>Hanimation.PATHMODE_DEFAULT&&u>=0&&a>=0){var p=getPathObject(e);var d=p.getParam();var v=e.path;var m=bezierGetPoint(v[u],v[a],h);m.x=e.pathLeft+m.x-o.rotateCenterX;m.y=e.pathTop+m.y-o.rotateCenterY;o.startX=m.x;o.startY=m.y;o.endX=o.startX+o.width;o.endY=o.startY+o.height;o.left=o.startX;o.top=o.startY;o.right=o.endX;o.bottom=o.endY}}}if(!o)o=i.param;if(n){if(o.keepAspect==undefined)o.keepAspect=n.keepAspect;if(o.rawWidth==undefined||isNaN(o.rawWidth))o.rawWidth=n.rawWidth;if(o.rawHeight==undefined||isNaN(o.rawHeight))o.rawHeight=n.rawHeight}return o},getTweenFactors:function(count,type){var factors=[];var position={x:0};var tween=new TWEEN.Tween(position);tween.to({x:1},1e3);if(!type)type="Linear.EaseNone";tween.easing(eval("TWEEN.Easing."+type));for(var i=0;i<count;i++)factors[i]=tween.getFactor(i/count);return factors}};Param={exchange:function(e,t,n){var r;var i;if(n){r=e;i=t}else{r=t;i=e}i.startX=r.startX;i.startY=r.startY;i.endX=r.endX;i.endY=r.endY;i.left=r.left;i.right=r.right;i.top=r.top;i.bottom=r.bottom;i.width=r.width;i.height=r.height;i.alpha=r.alpha;i.scaleX=r.scaleX;i.scaleY=r.scaleY;i.rotate=r.rotate;i.keepAspect=r.keepAspect==undefined?i.keepAspect:r.keepAspect;i.rawWidth=r.rawWidth==undefined?i.rawWidth:r.rawWidth;i.rawHeight=r.rawHeight==undefined?i.rawHeight:r.rawHeight;i.rotateCenterX=r.rotateCenterX;i.rotateCenterY=r.rotateCenterY;i.customPivot=r.customPivot},tweenParam:function(e,t,n,r){e.startX=t.startX+r*(n.startX-t.startX);e.startY=t.startY+r*(n.startY-t.startY);e.endX=t.endX+r*(n.endX-t.endX);e.endY=t.endY+r*(n.endY-t.endY);e.width=t.width+r*(n.width-t.width);e.height=t.height+r*(n.height-t.height);e.alpha=t.alpha+r*(n.alpha-t.alpha);e.scaleX=t.scaleX+r*(n.scaleX-t.scaleX);e.scaleY=t.scaleY+r*(n.scaleY-t.scaleY);e.rotate=t.rotate+r*(n.rotate-t.rotate);e.rotateCenterX=t.rotateCenterX+r*(n.rotateCenterX-t.rotateCenterX);e.rotateCenterY=t.rotateCenterY+r*(n.rotateCenterY-t.rotateCenterY);e.customPivot=true;e.rawWidth=t.rawWidth+r*(n.rawWidth-t.rawWidth);e.rawHeight=t.rawHeight+r*(n.rawHeight-t.rawHeight);if(t.fillInfo&&t.fillInfo&&(t.fillInfo.fillStyle==1||t.fillInfo.fillStyle==2)){e.fillInfo.fillStartPos.x=t.fillInfo.fillStartPos.x+r*(n.fillInfo.fillStartPos.x-t.fillInfo.fillStartPos.x);e.fillInfo.fillStartPos.y=t.fillInfo.fillStartPos.y+r*(n.fillInfo.fillStartPos.y-t.fillInfo.fillStartPos.y);e.fillInfo.fillEndPos.x=t.fillInfo.fillEndPos.x+r*(n.fillInfo.fillEndPos.x-t.fillInfo.fillEndPos.x);e.fillInfo.fillEndPos.y=t.fillInfo.fillEndPos.y+r*(n.fillInfo.fillEndPos.y-t.fillInfo.fillEndPos.y)}e.left=e.startX;e.top=e.startY;e.right=e.startX+e.width;e.bottom=e.startY+e.height},scale:function(e,t,n){e.startX=e.startX*t;e.startY=e.startY*n;e.endX=e.endX*t;e.endY=e.endY*n;e.rotateCenterX=e.rotateCenterX*t;e.rotateCenterY=e.rotateCenterY*n;if(e.fillInfo&&(e.fillInfo.fillStyle==1||e.fillInfo.fillStyle==2)){e.fillInfo.fillStartPos.x=e.fillInfo.fillStartPos.x*t;e.fillInfo.fillStartPos.y=e.fillInfo.fillStartPos.x*n;e.fillInfo.fillEndPos.x=e.fillInfo.fillEndPos.x*t;e.fillInfo.fillEndPos.y=e.fillInfo.fillEndPos.y*n}e.left=Math.min(e.startX,e.endX);e.right=Math.max(e.startX,e.endX);e.top=Math.min(e.startY,e.endY);e.bottom=Math.max(e.startY,e.endY);e.width=e.right-e.left;e.height=e.bottom-e.top},shift:function(e,t,n){e.startX+=t;e.startY+=n;e.endX+=t;e.endY+=n;e.left=Math.min(e.startX,e.endX);e.right=Math.max(e.startX,e.endX);e.top=Math.min(e.startY,e.endY);e.bottom=Math.max(e.startY,e.endY)}};inherit=function(e,t){e.prototype=new t;e.prototype.constructor=e};Hanimation.BufferParam=function(){this.direct=null;this.aux=null};Point={set:function(e,t,n){e.x=t;e.y=n},copy:function(e,t){e.x=t.x;e.y=t.y},offset:function(e,t,n){e.x=e.x+t;e.y=e.y+n},scale:function(e,t,n){e.x=e.x*t;e.y=e.y*n},isEqual:function(e,t){return t.x==e.x&&t.y==e.y}};TriPoint={set:function(e,t,n,r,i,s,o){e.nodeX=t;e.nodeY=n;e.forwardX=r;e.forwardY=i;e.backwardX=s;e.backwardY=o},copy:function(e,t){e.nodeX=t.nodeX;e.nodeY=t.nodeY;e.forwardX=t.forwardX;e.forwardY=t.forwardY;e.backwardX=t.backwardX;e.backwardY=t.backwardY},offset:function(e,t,n){e.nodeX=e.nodeX+t;e.nodeY=e.nodeY+n;e.forwardX=e.forwardX+t;e.forwardY=e.forwardY+n;e.backwardX=e.backwardX+t;e.backwardY=e.backwardY+n},scale:function(e,t,n){e.nodeX=e.nodeX*t;e.nodeY=e.nodeY*n;e.forwardX=e.forwardX*t;e.forwardY=e.forwardY*n;e.backwardX=e.backwardX*t;e.backwardY=e.backwardY*n},isEqual:function(e,t,n){return t.nodeX==e.nodeX&&t.nodeY==e.nodeY&&(n==0||t.forwardX==e.forwardX&&t.forwardY==e.forwardY&&t.backwardX==e.backwardX&&t.backwardY==e.backwardY)},setCounterPoint:function(e,t,n){var r,i,s,o,u,a,f,l,c,h;if(t){f=e.forwardX;l=e.forwardY;c=e.backwardX;h=e.backwardY}else{f=e.backwardX;l=e.backwardY;c=e.forwardX;h=e.forwardY}s=f-e.nodeX;o=l-e.nodeY;if(n){c=e.nodeX-s;h=e.nodeY-o}else{r=Math.sqrt(s*s+o*o);u=e.nodeX-c;a=e.nodeY-h;i=Math.sqrt(u*u+a*a);if(r==0||i==0){c=e.nodeX;h=e.nodeY}else{ratio=i/r;c=e.nodeX-s*ratio;h=e.nodeY-o*ratio}}if(t){e.backwardX=c;e.backwardY=h}else{e.forwardX=c;e.forwardY=h}}};Hanimation.AniObject=function(e){var t=navigator.userAgent.match(/iPad/i)!=null;var n=navigator.userAgent.match(/iPhone/i)!=null;this.useTouch=isMobile();var r=this.useTouch;this.anchorRadius=r?12:4;this.fillCtrlSize=r?16:4;this.forceAspectRatio=false;this.canRotate=true;this.dataRef=null;if(e){this.dataRef=e}this.auxParam=createParam();this.bufferParam=new Hanimation.BufferParam;this.bufferParam.direct=createParam();this.bufferParam.aux=createParam();this.locked=false;this.layerId=-1;this.frameId=-1;this.editDeltaX=0;this.editDeltaY=0;this.editStartX=0;this.editStartY=0;this.editEndX=0;this.editEndY=0;this.editLeft=0;this.editTop=0;this.editRight=0;this.editBottom=0;this.editFillStartX=0;this.editFillStartY=0;this.editFillEndX=0;this.editFillEndY=0;this.editRotate=0;this.editRotateBaseX=0;this.editRotateBaseY=0;this.editUpdateRotate=false;this.editOriginalStartX=0;this.editOriginalStartY=0;this.editOriginalEndX=0;this.editOriginalEndY=0;this.scaleBaseX=0;this.scaleBaseY=0;this.prevRegion=null;this.previewStrokeColor="#ff0000";this.controlFillColor="#ffff00";this.controlActiveFillColor="#ff0000";this.controlStrokeColor="#0000ff";this.editFillColor="#ff0000";this.fillCtrlStrokeColor="#ffffff";this.fillCtrlFillColor="#000000";this.highlightStrokeColor="#000088";this.aidStrokeColor="#008800";this.aidFillColor="#008800";this.focusMode=Hanimation.FM_EDIT;this.activeControl=-1;this.aryActiveNodes=[];this.isCreating=false;this.isEditing=false;this.hasRotation=false;this.drawMode=1;this.hitPos=Hanimation.HITTEST_NONE;this.minWidth=Hanimation.MIN_VALUE;this.minHeight=Hanimation.MIN_VALUE;this.maxWidth=Hanimation.MAX_VALUE;this.maxHeight=Hanimation.MAX_VALUE;this.eventListeners=[]};Hanimation.AniObject.prototype.setAttribute=function(e,t){var n=this.getParam();switch(e){case"fillColor":n.fillInfo.fillColors=[createColorStop(0,t.r|0,t.g|0,t.b|0,t.a||0)];case"strokeColor":var r=(t.r|0).toString(16);var i=(t.g|0).toString(16);var s=(t.b|0).toString(16);if(r.length==1)r="0"+r;if(i.length==1)i="0"+r;if(s.length==1)s="0"+r;n.strokeColor="#"+r+i+s;break;default:n[e]=t}};Hanimation.AniObject.prototype.getAttribute=function(e){if(e=="points"){if(this.dataRef&&this.dataRef.curve&&this.dataRef.curve.points)return this.dataRef.curve.points;else return[]}else if(e=="activeControl"){return this.activeControl}else{var t=this.getParam();return t[e]}};Hanimation.AniObject.prototype.setPosition=function(e,t,n){var r=this.getParam();if(!n){e=e-r.left;t=t-r.top}r.startX+=e;r.startY+=t;r.endX+=e;r.endY+=t;r.left+=e;r.top+=t;r.right+=e;r.bottom+=t};Hanimation.AniObject.prototype.getChildren=function(){var e=[];var t=this.dataRef.items?this.dataRef.items.length:0;for(var n=0;n<t;n++){var r=this.dataRef.items[n];object=getAniObject(r);e.push(object)}return e};Hanimation.AniObject.prototype.getParent=function(){return null};Hanimation.AniObject.prototype.offset=function(e,t){var n=this.dataRef.curve?this.dataRef.curve.points:[];var r=n.length;for(var i=0;i<r;i++){point=n[i];if(typeof point.x=="undefined")TriPoint.offset(point,e,t);else Point.offset(point,e,t)}};Hanimation.AniObject.prototype.processFlip=function(e,t,n,r,i){var r=r?r:0;var i=i?i:0;var s=this.getParam();if(s.vF||s.hF){var o=s.hF?t+r*2:0;var u=s.vF?n+i*2:0;var a=s.hF?-1:1;var f=s.vF?-1:1;e.translate(o,u);e.scale(a,f)}};Hanimation.AniObject.prototype.updateTweenedParam=function(e,t){var n=this.getParam();if(e.animated&&e.objects.length==1){var r=TimelineUnit.getKeyframe(e,t);if(r){var i=r;Param.exchange(r.param,n,true)}else{var s=TimelineUnit.getTweenParam(e,t,n);if(s){Param.exchange(s,n,true)}}}};Hanimation.AniObject.prototype.hitTest=function(e,t,n){var r=this.getParam();var i=0;var s=0;var o=r.width/2;var u=r.height/2;var a=this.anchorRadius;var f=Hanimation.HITTEST_NONE;var l=n==0&&this.focusMode==Hanimation.FM_EDIT;var c=ptInRect(e,t,r.left,r.top,r.left+r.width,r.top+r.height,this);if(n&8)return c?Hanimation.HITTEST_WITHIN:Hanimation.HITTEST_NONE;if(r.fillInfo){var h=r.fillInfo.fillStartPos.x+r.left;var p=r.fillInfo.fillStartPos.y+r.top;var d=r.fillInfo.fillEndPos.x+r.left;var v=r.fillInfo.fillEndPos.y+r.top;a=this.fillCtrlSize;if(ptInRect(e,t,h-a,p-a,h+a,p+a,this)){f=Hanimation.HITTEST_FILLSTART}else if(ptInRect(e,t,d-a,v-a,d+a,v+a,this)){f=Hanimation.HITTEST_FILLEND}if(f!==Hanimation.HITTEST_NONE){this.hitPos=f;return f}}var m;var g;for(var y=0;y<9;y++){m=Math.floor(y/3);g=y-m*3;i=r.left+g*o;s=r.top+m*u;if(m==1&&g==1&&r.customPivot){i=r.left+r.rotateCenterX;s=r.top+r.rotateCenterY}if(this.forceAspectRatio&&y&1)continue;if(ptInRect(e,t,i-a,s-a,i+a,s+a,this)){f=Hanimation.HITTEST+y+1;break}}var b=!l||f==Hanimation.HITTEST_LEFTTOP||f==Hanimation.HITTEST_LEFTBOTTOM||f==Hanimation.HITTEST_RIGHTTOP||f==Hanimation.HITTEST_RIGHTBOTTOM||f==Hanimation.HITTEST_WITHIN||f==Hanimation.HITTEST_PIVOT;if(this.useTouch&&(f==Hanimation.HITTEST_LEFT||f==Hanimation.HITTEST_RIGHT||f==Hanimation.HITTEST_TOP||f==Hanimation.HITTEST_BOTTOM||f==Hanimation.HITTEST_RIGHTTOP||f==Hanimation.HITTEST_LEFTBOTTOM||f==Hanimation.HITTEST_PIVOT)){f=Hanimation.HITTEST_WITHIN}if(f==Hanimation.HITTEST_PIVOT&&!(n&2))f=Hanimation.HITTEST_WITHIN;else if(!b){if(c)f=Hanimation.HITTEST_WITHIN;else f=Hanimation.HITTEST_NONE}else if(!l&&f==Hanimation.HITTEST_NONE&&c)f=Hanimation.HITTEST_WITHIN;if(f==Hanimation.HITTEST_NONE&&!l&&this.canRotate){var w=this.anchorRadius*2;i=r.left+r.width+w;s=r.top-w;if(this.focusMode==Hanimation.FM_SCALE){if(ptInRect(e,t,i-a,s-a,i+a,s+a,this))f=Hanimation.HITTEST_ROTATE;if(!this.useTouch){var E=a*4;i=r.left-w;s=r.top-w;if(ptInRect(e,t,i-E,s-E,i+a,s+a,this))f=Hanimation.HITTEST_ROTATE;i=r.left-w;s=r.top+r.height+w;if(ptInRect(e,t,i-E,s-a,i+a,s+E,this))f=Hanimation.HITTEST_ROTATE;i=r.left+r.width+w;s=r.top+r.height+w;if(ptInRect(e,t,i-a,s-a,i+E,s+E,this))f=Hanimation.HITTEST_ROTATE}}}this.hitPos=f;return f};Hanimation.AniObject.prototype.setVisible=function(e){var t=this.getParam();t.alpha=e?1:0};Hanimation.AniObject.prototype.setAlpha=function(e,t){var t=typeof t=="undefined"?false:t;if(!t){this.auxParam.alpha=e}else{var n=this.getParam();n.alpha=n.alpha*e;this.auxParam.alpha=1}return true};Hanimation.AniObject.prototype.setRotationCenter=function(e,t){var n=this.getParam();n.rotateCenterX=e;n.rotateCenterY=t};Hanimation.AniObject.prototype.getRotationCenter=function(e){var t=this.getParam();var n=t.rotateCenterX;var r=t.rotateCenterY;if(!e){n+=t.left;r+=t.top}return{x:n,y:r}};Hanimation.AniObject.prototype.getBoundRect=function(e){var e=typeof e=="undefined"?false:e;var t=this.getParam();var n={left:t.left*t.scaleX*this.auxParam.scaleX,top:t.top*t.scaleY*this.auxParam.scaleY,right:t.right*t.scaleX*this.auxParam.scaleX,bottom:t.bottom*t.scaleY*this.auxParam.scaleY};if(Math.abs(t.rotate)>.001&&e==false){var r=this.getRotationCenter(false);var i=r.x;var s=r.y;var o=rotatePoint(i,s,n.left,n.top,t.rotate);var u=rotatePoint(i,s,n.right,n.bottom,t.rotate);var a=rotatePoint(i,s,n.right,n.top,t.rotate);var f=rotatePoint(i,s,n.left,n.bottom,t.rotate);n.left=Math.min(o.x,Math.min(u.x,Math.min(a.x,f.x)));n.right=Math.max(o.x,Math.max(u.x,Math.max(a.x,f.x)));n.top=Math.min(o.y,Math.min(u.y,Math.min(a.y,f.y)));n.bottom=Math.max(o.y,Math.max(u.y,Math.max(a.y,f.y)))}n.width=n.right-n.left;n.height=n.bottom-n.top;return n};Hanimation.AniObject.prototype.getLiveParams=function(){return{direct:this.getParam(),aux:this.auxParam}};Hanimation.AniObject.prototype.getLiveParam=function(){var e=createParam();var t=this.getParam();var n=this.auxParam;if(this.isCreating){e.startX=this.editStartX;e.startY=this.editStartY;e.endX=this.editEndX;e.endY=this.editEndY;e.left=Math.min(e.startX,e.endX);e.right=Math.max(e.startX,e.endX);e.top=Math.min(e.startY,e.endY);e.bottom=Math.max(e.startY,e.endY)}else{e.startX=t.startX*n.scaleX;e.startY=t.startY*n.scaleY;e.endX=t.endX*n.scaleX;e.endY=t.endY*n.scaleY;e.left=t.left*n.scaleX;e.right=t.right*n.scaleX;e.top=t.top*n.scaleY;e.bottom=t.bottom*n.scaleY;e.rawWidth=t.rawWidth;e.rawHeight=t.rawHeight;e.keepAspect=t.keepAspect}e.width=e.right-e.left;e.height=e.bottom-e.top;e.rotate=t.rotate;e.strokeColor=t.strokeColor;e.lineWidth=t.lineWidth;return e};Hanimation.AniObject.prototype.setScale=function(e,t,n){var n=typeof n=="undefined"?false:n;var r=this.getParam();if(!n){this.auxParam.scaleX=e;this.auxParam.scaleY=t}else{this.auxParam.scaleX=1;this.auxParam.scaleY=1;if(this.dataRef.curve){var i=this.dataRef.curve.points.length;var s;for(var o=0;o<i;o++){s=this.dataRef.curve.points[o];if(typeof s.x!="undefined"){s.x=s.x*e;s.y=s.y*t}else{s.nodeX=s.nodeX*e;s.nodeY=s.nodeY*t;s.forwardX=s.forwardX*e;s.forwardY=s.forwardY*t;s.backwardX=s.backwardX*e;s.backwardY=s.backwardY*t}}}i=typeof this.dataRef.aryAnchors=="undefined"?0:this.dataRef.aryAnchors.length;for(o=0;o<i;o++){s=this.dataRef.aryAnchors[o];s.x=s.x*e;s.y=s.y*t}r.startX=r.startX*e;r.startY=r.startY*t;r.endX=r.endX*e;r.endY=r.endY*t;if(r.fillInfo&&(r.fillInfo.fillStyle==1||r.fillInfo.fillStyle==2)){r.fillInfo.fillStartPos.x=r.fillInfo.fillStartPos.x*e;r.fillInfo.fillStartPos.y=r.fillInfo.fillStartPos.y*t;r.fillInfo.fillEndPos.x=r.fillInfo.fillEndPos.x*e;r.fillInfo.fillEndPos.y=r.fillInfo.fillEndPos.y*t}r.rotateCenterX=r.rotateCenterX*e;r.rotateCenterY=r.rotateCenterY*t;r.left=Math.min(r.startX,r.endX);r.right=Math.max(r.startX,r.endX);r.top=Math.min(r.startY,r.endY);r.bottom=Math.max(r.startY,r.endY);r.width=r.right-r.left;r.height=r.bottom-r.top}return true};Hanimation.AniObject.prototype.getParameter=function(e){return this.getParam()};Hanimation.AniObject.prototype.setName=function(e){var t=Mugeda.setIdName(this.dataRef,e);if(t==0)this.getParam().name=e;return t};Hanimation.AniObject.prototype.setRotation=function(e){this.auxParam.rotate=e*.01745329252};Hanimation.AniObject.prototype.setScaleFactor=function(e,t){this.setScale(e,t,false)};Hanimation.AniObject.prototype.prepareRotate=function(e){var t=this.getLiveParam();var n=this.getParam();var r=this.auxParam;var i=t.rotate+r.rotate;if(Math.abs(i)>.001&&!this.isCreating){var s,o;if(n.rotateCenterX==undefined||n.rotateCenterY==undefined){s=n.width/2;o=n.height/2}else{s=n.rotateCenterX;o=n.rotateCenterY}var u=s*r.scaleX+t.left;var a=o*r.scaleY+t.top;var f=Math.sqrt(u*u+a*a);var l=i;var c=Math.atan2(a,u);var h=f*Math.cos(l+c);var p=f*Math.sin(l+c);var d=u-h;var v=a-p;e.translate(d,v);e.rotate(i)}};Hanimation.AniObject.prototype.setRotateBase=function(e,t){var n=this.dataRef.param;if(!n.customPivot){n.rotateCenterX=e-n.left;n.rotateCenterY=t-n.top}};Hanimation.AniObject.prototype.updateBoundRect=function(){var e=this.getParam();e.left=Math.min(e.startX,e.endX);e.right=Math.max(e.startX,e.endX);e.top=Math.min(e.startY,e.endY);e.bottom=Math.max(e.startY,e.endY);e.width=e.right-e.left;e.height=e.bottom-e.top;if(!this.editUpdateRotate&&!e.customPivot){this.setRotateBase((e.left+e.right)/2,(e.top+e.bottom)/2)}};Hanimation.AniObject.prototype.getParam=function(e){var t=this.dataRef.param;return this.dataRef.param};Hanimation.AniObject.prototype.setLayerFrame=function(e,t){this.layerId=e;this.frameId=t};Hanimation.AniObject.prototype.getLayerFrame=function(){return{layer:this.layerId,frame:this.frameId}};Hanimation.AniObject.prototype.copyData=function(e){if(e){if(this.dataRef==e)return;this.dataRef.param=JSON.clone(e.param);if(this.dataRef.curve){this.dataRef.curve.closed=e.curve.closed;var t=e.curve.points.length;this.dataRef.curve.points=[];for(var n=0;n<t;n++){if(typeof e.curve.points[n].x!="undefined"){var r=createPoint();Point.copy(r,e.curve.points[n])}else{var r=createTriPoint();TriPoint.copy(r,e.curve.points[n])}this.dataRef.curve.points[n]=r}}}};Hanimation.AniObject.prototype.draw=function(e,t){if(typeof t=="undefined")t=1;this.drawMode=t;var n=this.getLiveParam();var r=this.getParam();e.save();e.globalAlpha=this.locked?.3:g_alpha*r.alpha*this.auxParam.alpha;e.lineWidth=r.lineWidth;e.lineCap=r.lineCap;e.lineJoin=r.lineJoin;var i;this.prepareRotate(e);if(t==1){i=new RGBColor(this.previewStrokeColor);e.strokeStyle=i.toRGB();this.drawRaw(e,n,true)}else{if(r.fillInfo){e.fillStyle=createFillPattern(e,r.fillInfo);this.drawRaw(e,n,false)}i=new RGBColor(n.strokeColor);e.strokeStyle=i.toRGB();this.drawRaw(e,n,true)}if(t==1&&(this.hitPos==Hanimation.HITTEST_FILLSTART||this.hitPos==Hanimation.HITTEST_FILLEND)){this.drawFillControls(e,true,true)}this.postDraw(e,t);e.restore()};Hanimation.AniObject.prototype.drawRaw=function(e,t,n){};Hanimation.AniObject.prototype.postDraw=function(e,t){var n=this.getParam();if(t!=1||typeof n.customPivot=="undefined"||n.customPivot==false)return;var r=this.editPivotX;var i=this.editPivotY;var s=new RGBColor(this.previewStrokeColor);e.strokeStyle=s.toRGB();e.beginPath();e.arc(r,i,this.anchorRadius,0,Math.PI*2,false);e.stroke()};Hanimation.AniObject.prototype.addEventListener=function(e,t){if(!this.eventListeners[e])this.eventListeners[e]=[];this.eventListeners[e].push(t)};Hanimation.AniObject.prototype.removeEventListener=function(e,t){if(!this.eventListeners[e])return;var n=this.eventListeners[e];var r=n.length;for(var i=0;i<r;i++){if(n[i]==t){n.splice(i,1);break}}if(this.eventListeners[e].length==0)delete this.eventListeners[e]};Hanimation.AniObject.prototype.setButton=function(e,t,n){if(e!=null){this.buttonEnabled=true;if(typeof e=="number")e={from:e,to:e,noLoop:true};this.setSegment("_Btn_normal_",e);if(t!=null){if(typeof t=="number")t={from:t,to:t,noLoop:true};this.setSegment("_Btn_press_",t);this.addEventListener("mousedown",function(e){if(!this.buttonEnabled)return;this.playSegment("_Btn_press_")})}n=n||e;if(typeof n=="number")n={from:n,to:n,noLoop:true};this.setSegment("_Btn_up_",n);var r=function(e){if(!this.buttonEnabled)return;this.playSegment("_Btn_up_")};this.addEventListener("mouseup",r);this.addEventListener("mouseout",r);this.playSegment("_Btn_normal_")}};Hanimation.Point=function(e,t){this.x=e;this.y=t};Hanimation.TriPoint=function(e,t,n,r,i,s){this.loadParams=function(e){var t=e.split(",");this.nodeX=parseInt(t[0]);this.nodeY=parseInt(t[1]);this.forwardX=parseInt(t[2]);this.forwardY=parseInt(t[3]);this.backwardX=parseInt(t[4]);this.backwardY=parseInt(t[5])};this.saveParams=function(e){saveParam(e,"tripoint","array",this.nodeX+","+this.nodeY+","+this.forwardX+","+this.forwardY+","+this.backwardX+","+this.backwardY)}};Hanimation.Curve=function(e,t,n){Hanimation.AniObject.call(this,e);if(e)e.type=Hanimation.SHAPE_CURVE;if(this.dataRef&&!isDefined(this.dataRef.aryAnchors))this.dataRef.aryAnchors=[];this.pending=false;this.displayControl=true;this.currentPoint=null;this.aryBackupPoints=[];this.aryEditTriPoint=[];this.aryBackupAnchors=[];this.addPoints(t,n)};inherit(Hanimation.Curve,Hanimation.AniObject);Hanimation.Curve.prototype.setDisplayControl=function(e){this.displayControl=e};Hanimation.Curve.prototype.hitTest=function(e,t,n){var r=Hanimation.AniObject.prototype.hitTest.call(this,e,t,n);if(n==3&&this.useTouch)return r;var i=this.getParam();e=e-i.startX;t=t-i.startY;if(n&8){var s=Bezier.isInPath(e,t,this.dataRef.curve.points);return s?Hanimation.HITTEST_WITHIN:Hanimation.HITTEST_NONE}var o=n&2;var u=n&32;var a=u;var f=Hanimation.HITTEST_NONE;var l=this.dataRef.curve.points.length;var c;for(var h=0;h<l;h++){c=this.dataRef.curve.points[h];if(e>=c.nodeX-this.anchorRadius&&e<c.nodeX+this.anchorRadius&&t>=c.nodeY-this.anchorRadius&&t<c.nodeY+this.anchorRadius){this.activeControl=3*h;f=Hanimation.HITTEST_CONTROL;if(a){if(o==0)this.aryActiveNodes=[];this.aryActiveNodes[h]=this.aryActiveNodes[h]==1?0:1}break}else if(e>=c.forwardX-this.anchorRadius&&e<c.forwardX+this.anchorRadius&&t>=c.forwardY-this.anchorRadius&&t<c.forwardY+this.anchorRadius&&this.aryActiveNodes[h]==1){this.activeControl=3*h+1;f=Hanimation.HITTEST_CONTROL;break}else if(e>=c.backwardX-this.anchorRadius&&e<c.backwardX+this.anchorRadius&&t>=c.backwardY-this.anchorRadius&&t<c.backwardY+this.anchorRadius&&this.aryActiveNodes[h]==1){this.activeControl=3*h+2;f=Hanimation.HITTEST_CONTROL;break}}if(f!=Hanimation.HITTEST_CONTROL){this.activeControl=-1;if(o==0&&a)this.aryActiveNodes=[];f=r;if(f!=Hanimation.HITTEST_ROTATE&&f!=Hanimation.HITTEST_FILLSTART&&f!=Hanimation.HITTEST_FILLEND){var p=Bezier.isInPath(e,t,this.dataRef.curve.points);f=p?Hanimation.HITTEST_WITHIN:Hanimation.HITTEST_NONE}}else if(r==Hanimation.HITTEST_FILLSTART||r==Hanimation.HITTEST_FILLEND)f=r;else if(this.focusMode==Hanimation.FM_EDIT&&!u)f=Hanimation.HITTEST_WITHIN;this.hitPos=f;return f};Hanimation.Curve.prototype.addPoints=function(e,t,n){if(e&&this.dataRef){this.dataRef.curve.closed=t;var r=e.length;for(var i=0;i<r;i++){var s=e[i];var o=createTriPoint(s.nodeX,s.nodeY,s.forwardX,s.forwardY,s.backwardX,s.backwardY);if(n)o.id=getIncrementalId();else if(typeof s.id!="undefined")o.id=s.id;this.dataRef.curve.points.push(o)}if(t)this.dataRef.curve.closed=true;this.updateBoundRect()}};Hanimation.Curve.prototype.updateBoundRect=function(){if(this.isEditing)return;var e=this.getParam();var t=e.left;var n=e.top;var r=this.isCreating?false:true;var i=[];i.push(this.dataRef.curve.points);var s=Bezier.getBoundary(i);var o=s.left;var u=s.top;if(r){e.startX=e.startX+o;e.startY=e.startY+u}else{e.startX=s.left;e.startY=s.top}e.width=s.right-s.left;e.height=s.bottom-s.top;e.left=e.startX;e.top=e.startY;e.right=e.left+e.width;e.bottom=e.top+e.height;e.endX=e.right;e.endY=e.bottom;var a=this.dataRef.curve.points.length;for(var f=0;f<a;f++){point=this.dataRef.curve.points[f];TriPoint.offset(point,-o,-u)}var a=this.dataRef.aryAnchors.length;for(var f=0;f<a;f++){point=this.dataRef.aryAnchors[f];point.x=point.x-o;point.y=point.y-u}e.rotate=0;switch(this.hitPos){case Hanimation.HITTEST_CONTROL:e.fillInfo.fillStartPos.x-=o;e.fillInfo.fillStartPos.y-=u;e.fillInfo.fillEndPos.x-=o;e.fillInfo.fillEndPos.y-=u;break;case Hanimation.HITTEST_LEFTTOP:case Hanimation.HITTEST_RIGHTBOTTOM:case Hanimation.HITTEST_RIGHTTOP:case Hanimation.HITTEST_LEFTBOTTOM:case Hanimation.HITTEST_TOP:case Hanimation.HITTEST_BOTTOM:case Hanimation.HITTEST_LEFT:case Hanimation.HITTEST_RIGHT:var l=this.editFillStartX/(this.editRight-this.editLeft);var c=this.editFillStartY/(this.editBottom-this.editTop);e.fillInfo.fillStartPos.x=(e.right-e.left)*l;e.fillInfo.fillStartPos.y=(e.bottom-e.top)*c;l=this.editFillEndX/(this.editRight-this.editLeft);c=this.editFillEndY/(this.editBottom-this.editTop);e.fillInfo.fillEndPos.x=(e.right-e.left)*l;e.fillInfo.fillEndPos.y=(e.bottom-e.top)*c;break}};Hanimation.Curve.prototype.draw=function(e,t){if(typeof t=="undefined")t=1;e.save();var n=this.auxParam;var r=n.scaleX;var i=n.scaleY;var s=this.getParam();if(Math.abs(n.rotate)>.001)this.prepareRotate(e);if(!this.isCreating){e.translate(s.startX*r,s.startY*i)}e.lineWidth=s.lineWidth;e.lineCap=s.lineCap;e.lineJoin=s.lineJoin;e.globalAlpha=this.locked?.3:g_alpha*s.alpha*this.auxParam.alpha;var o=this.dataRef.curve.points.length;var u=createTriPoint();var s=this.getParam();var a=this.activeControl%3;var f=Math.floor(this.activeControl/3);var l=0;var c;if(t==1){c=new RGBColor(this.previewStrokeColor);e.strokeStyle=c.toRGB()}else{e.strokeStyle=getColor(s.strokeColor);e.fillStyle=createFillPattern(e,s.fillInfo,r,i)}var h=o;var p=0;var d=true;if(this.framePercent===undefined||this.framePercent>=this.percentTo)h=o;else if(this.framePercent>=0&&this.percentFrom<=this.framePercent&&this.framePercent<this.percentTo){var v=o;if(!this.dataRef.curve.closed)v--;var p=v*(this.framePercent-this.percentFrom)/(this.percentTo-this.percentFrom);h=Math.floor(p);d=o-p<.001;p=p-h;h=Math.min(o,h+1)}else h=0;var m=t==1?1:2;if(!d)m=1;for(var g=0;g<m;g++){e.beginPath();for(var y=0;y<h-1;y++){point1=this.dataRef.curve.points[y];point2=this.dataRef.curve.points[y+1];if(y==0)e.moveTo(point1.nodeX*r,point1.nodeY*i);e.bezierCurveTo(point1.forwardX*r,point1.forwardY*i,point2.backwardX*r,point2.backwardY*i,point2.nodeX*r,point2.nodeY*i)}if(this.progressMode>0&&p>.001){if(y==0){point1=this.dataRef.curve.points[0];e.moveTo(point1.nodeX*r,point1.nodeY*i)}var b=-1;var w;if(h<o){b=h-1;w=h}else if(this.dataRef.curve.closed&&h==o){b=h-1;w=0}if(b>=0){var E=[];var S=createTriPoint();TriPoint.copy(S,this.dataRef.curve.points[b]);E.push(S);S=createTriPoint();TriPoint.copy(S,this.dataRef.curve.points[w]);E.push(S);Bezier.subDivision2(E,0,p);e.bezierCurveTo(E[0].forwardX*r,E[0].forwardY*i,E[1].backwardX*r,E[1].backwardY*i,E[1].nodeX*r,E[1].nodeY*i);var x=E.length;for(var T=0;T<x;T++)delete E[T];delete E}}if(this.dataRef.curve.closed&&o>1&&h==o&&d){point1=this.dataRef.curve.points[o-1];point2=this.dataRef.curve.points[0];if(TriPoint.isEqual(point1,point2,0)==false){e.bezierCurveTo(point1.forwardX*r,point1.forwardY*i,point2.backwardX*r,point2.backwardY*i,point2.nodeX*r,point2.nodeY*i)}}if(m>1&&g==0)e.fill();else e.stroke()}if(t==1&&this.displayControl&&!this.useTouch){e.lineWidth=1;for(var y=0;y<o;y++){TriPoint.copy(u,this.dataRef.curve.points[y]);TriPoint.scale(u,r,i);if(this.aryActiveNodes.length>0&&this.isEditing){l=0;if(f==y)l=8+4;else{if(f>0&&y==f-1)l=l|8|4|1;if(f>=0&&f<o-1&&y==f+1)l=l|8|4|2}}else{l=y==0?1:0;if(o>1&&y==o-1)l=l|2;if(o<2||y>=o-2)l=l|4}if(this.aryActiveNodes[y]==1)l=l|16;this.drawTriPoint(e,u,l)}}if(t==1&&(this.hitPos==Hanimation.HITTEST_FILLSTART||this.hitPos==Hanimation.HITTEST_FILLEND)){this.drawFillControls(e,false,true)}this.postDraw(e,t);e.restore()};Hanimation.Path=function(e,t,n){Hanimation.Curve.call(this,e,t,n);if(e)e.type=Hanimation.SHAPE_PATH};inherit(Hanimation.Path,Hanimation.Curve);Hanimation.BShape=function(e){Hanimation.Curve.call(this,e);if(e)e.type=Hanimation.SHAPE_BSHAPE;this.aryControls=[]};inherit(Hanimation.BShape,Hanimation.Curve);Hanimation.BRectangle=function(e){Hanimation.BShape.call(this,e);if(e)e.type=Hanimation.SHAPE_RECTANGLE};inherit(Hanimation.BRectangle,Hanimation.BShape);Hanimation.BEllipse=function(e){Hanimation.BShape.call(this,e);if(e)e.type=Hanimation.SHAPE_ELLIPSE};inherit(Hanimation.BEllipse,Hanimation.BShape);Hanimation.BLine=function(e){Hanimation.BShape.call(this,e);if(e)e.type=Hanimation.SHAPE_LINE};inherit(Hanimation.BLine,Hanimation.BShape);Hanimation.BLine.prototype.hitTest=function(e,t,n){var r=Hanimation.Curve.prototype.hitTest.call(this,e,t,n);var i=this.dataRef.curve.points[0];var s=this.dataRef.curve.points[1];var o=this.getParam();var u=ptInRect(e,t,o.left,o.top,o.right,o.bottom);e=e-o.startX;t=t-o.startY;var a=4;if(r!=Hanimation.HITTEST_CONTROL){var f=s.nodeX-i.nodeX;var l=s.nodeY-i.nodeY;var c=Math.abs(f*(i.nodeY-t)-(i.nodeX-e)*l)/Math.sqrt(f*f+l*l);if(c<a&&u)r=Hanimation.HITTEST_WITHIN}this.hitPos=r;return r};Hanimation.BRounded=function(e){Hanimation.BShape.call(this,e);if(e)e.type=Hanimation.SHAPE_ROUNDED;if(!isDefined(e.cornerRadius))e.cornerRadius=new Array(16,16,16,16);this.setDisplayControl(false)};inherit(Hanimation.BRounded,Hanimation.BShape);Hanimation.BRounded.prototype.hitTest=function(e,t,n){var r=Hanimation.Curve.prototype.hitTest.call(this,e,t,n);if(n&8)return r;if(r==Hanimation.HITTEST_CONTROL){var i=Math.floor(this.activeControl/3);if(!(i==1||i==2||i==5||i==6)){r=Hanimation.HITTEST_NONE;this.activeControl=0}}this.hitPos=r;return r};Hanimation.BRounded.prototype.copyData=function(e){if(!e)return;if(this.dataRef==e)return;Hanimation.BShape.prototype.copyData.call(this,e);if(e.cornerRadius)this.dataRef.cornerRadius=e.cornerRadius.slice(0);if(e.curve&&e.curve.points.length==8){this.clearControlPoints();this.addControlPoint(this.dataRef.curve.points[1].nodeX,this.dataRef.curve.points[1].nodeY);this.addControlPoint(this.dataRef.curve.points[2].nodeX,this.dataRef.curve.points[2].nodeY);this.addControlPoint(this.dataRef.curve.points[5].nodeX,this.dataRef.curve.points[5].nodeY);this.addControlPoint(this.dataRef.curve.points[6].nodeX,this.dataRef.curve.points[6].nodeY)}if(e.aryAnchors){this.clearAnchorPoints();this.dataRef.aryAnchors=e.aryAnchors.slice(0)}};Hanimation.BRounded.prototype.setScale=function(e,t,n){Hanimation.AniObject.prototype.setScale.call(this,e,t,n);if(n){var r=this.dataRef;r.cornerRadius[0]=r.cornerRadius[0]*t;r.cornerRadius[1]=r.cornerRadius[1]*t;r.cornerRadius[2]=r.cornerRadius[2]*t;r.cornerRadius[3]=r.cornerRadius[3]*t}return true};Hanimation.Polygon=function(e){Hanimation.BShape.call(this,e);if(e)e.type=Hanimation.SHAPE_POLYGON;var t=this.dataRef.param;if(!isDefined(t.innerX)){t.innerX=0;t.innerY=0;t.outerX=0;t.outerY=0;t.centerX=0;t.centerY=0;t.edges=5;t.section=5;t.innerPercent=1}this.previousEdges=t.edges;this.previousSection=t.section;this.leftBound=0;this.rightBound=0;this.topBound=0;this.bottomBound=0;this.previousInnerPercent=1;this.prevCenterX=0;this.prevCenterY=0;this.prevOuterX=0;this.prevOuterY=0;this.prevInnerX=0;this.prevInnerY=0};inherit(Hanimation.Polygon,Hanimation.BShape);Hanimation.Polygon.prototype.hitTest=function(e,t,n){var r=Hanimation.AniObject.prototype.hitTest.call(this,e,t,n);if(r==Hanimation.HITTEST_FILLSTART||r==Hanimation.HITTEST_FILLEND){this.hitPos=r;return r}var i=Hanimation.HITTEST_NONE;var s=this.getParam();if(e>=s.outerX-this.anchorRadius&&e<s.outerX+this.anchorRadius&&t>=s.outerY-this.anchorRadius&&t<s.outerY+this.anchorRadius){this.activeControl=1;i=Hanimation.HITTEST_CONTROL}else if(e>=this.leftBound/2+this.rightBound/2-this.anchorRadius&&e<this.leftBound/2+this.rightBound/2+this.anchorRadius&&t>=this.topBound-this.anchorRadius&&t<this.topBound+this.anchorRadius){this.activeControl=2;i=Hanimation.HITTEST_CONTROL}else if(e>=this.leftBound/2+this.rightBound/2-this.anchorRadius&&e<this.leftBound/2+this.rightBound/2+this.anchorRadius&&t>=this.bottomBound-this.anchorRadius&&t<this.bottomBound+this.anchorRadius){this.activeControl=3;i=Hanimation.HITTEST_CONTROL}else if(e>=s.innerX-this.anchorRadius&&e<s.innerX+this.anchorRadius&&t>=s.innerY-this.anchorRadius&&t<s.innerY+this.anchorRadius){this.activeControl=4;i=Hanimation.HITTEST_CONTROL}if(i!=Hanimation.HITTEST_CONTROL){i=Hanimation.Curve.prototype.hitTest.call(this,e,t,n)}this.hitPos=i;return i};Hanimation.Polygon.prototype.copyData=function(e){if(!e)return;if(this.dataRef==e)return;Hanimation.AniObject.prototype.copyData.call(this,e);this.dataRef.param.symblId=e.param.symbolId;this.dataRef.param.offsetX=e.param.offsetX;this.dataRef.param.offsetY=e.param.offsetY};Hanimation.Polygon.prototype.setScale=function(e,t,n){Hanimation.AniObject.prototype.setScale.call(this,e,t,n);if(n){var r=this.getParam();r.innerX=r.innerX*e;r.innerY=r.innerY*t;r.outerX=r.outerX*e;r.outerY=r.outerY*t;r.centerX=r.centerX*e;r.centerY=r.centerY*t}return true};Hanimation.Pencil=function(e,t){Hanimation.AniObject.call(this,e);if(e)e.type=Hanimation.SHAPE_PENCIL;this.lastPoint=null;this.dataRef.curve.closed=false;this.dataRef.aryAnchors=[];this.displayControl=false;if(!isDefined(this.dataRef.param.smooth))this.dataRef.param.smooth=3};inherit(Hanimation.Pencil,Hanimation.BShape);Hanimation.Rectangle=function(e){Hanimation.AniObject.call(this,e);if(e)e.type=Hanimation.SHAPE_RECTANGLE};inherit(Hanimation.Rectangle,Hanimation.AniObject);Hanimation.Rectangle.prototype.drawRaw=function(e,t,n){if(n)e.strokeRect(t.left,t.top,t.width,t.height);else e.fillRect(t.left,t.top,t.width,t.height)};Hanimation.Camera=function(e){Hanimation.Rectangle.call(this,e);if(e)e.type=Hanimation.SHAPE_CAMERA;this.imgCam=null;this.iconW=32;this.iconH=24;this.forceAspectRatio=true;var t=this.getParam();var n=createFillInfo();n.fillColors=[createColorStop(0,128,128,128,.3)];t.fillInfo=n;t.strokeColor="#600000";t.lineWidth=1};inherit(Hanimation.Camera,Hanimation.Rectangle);Hanimation.Picture=function(e){Hanimation.Rectangle.call(this,e);if(e){e.type=Hanimation.SHAPE_PICTURE;e.param.fillInfo=null}if(!isDefined(this.dataRef.param.imageSrc))this.dataRef.param.imageSrc="";this.objImage=null;this.prevWidth=0;this.prevHeight=0};inherit(Hanimation.Picture,Hanimation.Rectangle);Hanimation.Picture.prototype.drawRaw=function(e,t,n){e.save();if(this.drawMode==1){e.globalAlpha=.4;Hanimation.Rectangle.prototype.drawRaw.call(this,e,t,n)}try{var r=Math.round(t.left);var i=Math.round(t.top);var s=/[^.]+$/.exec(this.dataRef.param.imageSrc)[0];var o=s&&s.toLowerCase()=="svg";var u=this.dataRef.guid;var a=false;if(this.drawMode==0){this.prevWidth=t.width;this.prevHeight=t.height}e.translate(r,i);var f=0;var l=0;var c=t.width;var h=t.height;if(t.keepAspect){var p=t.rawWidth/t.rawHeight;var d=t.width/t.height;if(p>d){c=t.width;h=Math.floor(c/p);l=Math.floor((t.height-h)/2)}else if(p<d){h=t.height;c=Math.floor(h*p);f=Math.floor((t.width-c)/2)}}this.processFlip(e,t.width,t.height);var v=this.dataRef.param.imageSrc;var m=null;if(!a){m=ImageCache.getImage(v);if(!m)m=ImageCache.getImage(u)}if(!m){if(o){}else{this.objImage=new Image;var g=this.objImage;g.src=this.dataRef.param.imageSrc;g.objParam=this.dataRef.param;g.onload=function(){this.objParam.rawWidth=this.width;this.objParam.rawHeight=this.height;ImageCache.updateImage(v,this);if(Hanimation.ImageCacheCallback)Hanimation.ImageCacheCallback({image:this,id:u,source:this.src})};g.onerror=function(){this.imageSrc=this.imageSrc=="res/noimage.png"?Mugeda.emptyImg:"res/noimage.png"}}if(!o){ImageCache.updateImage(u,this.objImage)}}else e.drawImage(m,f,l,c,h)}catch(y){var b=y.toString()}e.restore()};Hanimation.Text=function(e){Hanimation.AniObject.call(this,e);if(e)e.type=Hanimation.SHAPE_TEXT;var t=this.dataRef.param;if(!isDefined(t.fontSize)){t.fontSize="64";t.fontStyle="";t.fontWeight="";t.fontFamily="Arial";t.textAlign="left";t.textVAlign="middle";t.textContent="Text";t.textDecoration=""}this.textWidth=0;this.textHeight=0};inherit(Hanimation.Text,Hanimation.AniObject);Hanimation.Text.prototype.draw=function(e,t){function n(e,t,r,i,s,o,u){if(isNaN(s)||isNaN(o))return;var a=r!=null&&i!=null&&(s!=null||o!=null),f=u&&u.align||"left",l=u&&u.valign||"top",c=u&&u.wrap||true,h=u&&u.overflow||"display",p=h=="display",d=u&&u.lineHeight||e.measureText("").width+4,v=t.replace(/(\r\n|\n\r|\r|\n)/g,"\n").split("\n"),m=0,g=0,y=r,b=i,w=null,E=s==null,S=h=="display",x=l!="top";a=!x||u&&u.totalHeight;if(x&&a){if(u.totalHeight>o){b=i}else{S=true;if(l=="middle"){b=i+(o-u.totalHeight)/2}else if(l=="bottom"){b=i+(o-u.totalHeight)}}}if(o==null){o=Hanimation.MAX_VALUE;S=true}if(!S&&a){w=document.getElementById("canvas_text_buffer");if(!w){w=document.createElement("canvas");w.id="canvas_text_buffer";w.style.display="none";e.canvas.parentNode.appendChild(w)}w.width=e.canvas.width;w.height=e.canvas.height;var T=w.getContext("2d");T.fillStyle=e.fillStyle;T.strokeStyle=e.strokeStyle;T.shadowBlur=e.shadowBlur;T.shadowOffsetX=e.shadowOffsetX;T.shadowOffsetY=e.shadowOffsetY;T.shadowColor=e.shadowColor;T.font=e.font}var N=!T||S||!a?e:T;N.textBaseline="alphabetic";N.textAlign=f;if(f=="center"){y+=s/2}else if(f=="right"){y+=s}else if(f!="left"){N.textAlign=left}if(E){s=Hanimation.MAX_VALUE}b+=d/7*6;var C=function(e){if(a&&(p||d*g<o)){if(u.mode=="stroke")N.strokeText(e,y,b+d*g);else N.fillText(e,y,b+d*g)}g++;_=N.measureText(e.replace(/\s*$/,"")).width;if(_>m){m=_}};var k=function(e){var t="",n=[];while(e.length){var r="";r=e.match(/^[$\(\[\{]*\d+(?:\.\d+)*[!%\),\.:;>\?\]\}?]*/);if(r){n.push(r[0]);e=e.substring(r[0].length);continue}r=e.match(/^[$\(\[\{]*[a-zA-z]+[!%\),\.:;>\?\]\}?]*/);if(r){n.push(r[0]);e=e.substring(r[0].length);continue}r=e.match(/^[$\(\[\{]*[\u4e00-\u9fa5][!%\),\.:;>\?\]\}?]*/);if(r){n.push(r[0]);e=e.substring(r[0].length);continue}r=e.match(/^[$\(\[\{]+[!%\),\.:;>\?\]\}?]+/);if(r){n.push(r[0]);e=e.substring(r[0].length);continue}r=e.match(/^\s+/);if(r){n.push(r[0]);e=e.substring(r[0].length);continue}n.push(e.charAt(0));e=e.substring(1)}return n};for(var L=0;L<v.length;L++){var A=k(v[L]),O=1;if(!S)N.drawImage(e.canvas,0,0);while(A.length&&O<=A.length){var M=A.slice(0,O).join(""),_=N.measureText(M.replace(/\s*$/,"")).width;if(_>s){if(O==1){M=A.slice(0,1).join("");A=A.splice(1)}else{M=A.slice(0,O-1).join("");A=A.splice(O-1)}C(M.replace(/\s*$/,""));O=1}else{O++}}if(O>0){C(A.join(""))}}if(!S){var D=s,P=o,H=g*d;if(E){r=0;D=N.canvas.width}var B=N.getImageData(0,i,N.canvas.width,P);content.putImageData(B,0,i)}if(x&&!a){u=u||{};u.totalHeight=d*g;n(e,t,r,i,s,o,u)}if(s>Hanimation.MAX_VALUE){if(f=="right")r-=m;else if(f=="center")r-=m/2;s=m}if(o>Hanimation.MAX_VALUE){o=g*d}return{x:r,y:i,w:s,h:o}}if(typeof t=="undefined")t=1;var r=this.getParam();if(!r.width||r.width==0){r.width=142;r.height=parseInt(r.fontSize)+8}e.save();e.globalAlpha=this.locked?.3:g_alpha*r.alpha*this.auxParam.alpha;this.prepareRotate(e);var i=this.auxParam;var s=i.scaleX;var o=i.scaleY;if(!this.isCreating){e.translate(r.startX*s,r.startY*o)}e.lineWidth=r.lineWidth;e.lineCap=r.lineCap;e.lineJoin=r.lineJoin;var u=0;var a;if(t==1){a=new RGBColor(this.previewStrokeColor);e.strokeStyle=a.toRGB();e.strokeRect(0,0,r.width*s,r.height*o)}else{e.strokeStyle=getColor(r.strokeColor);e.fillStyle=createFillPattern(e,r.fillInfo,s,o)}var f=this.dataRef.param.fontSize*Math.max(s,o);e.alphabetic="top";e.font=f+"px "+this.dataRef.param.fontFamily;if(this.dataRef.param.fontWeight=="bold")e.font="bold "+e.font;if(this.dataRef.param.fontStyle=="italic")e.font="italic "+e.font;var l=unescape(r.textContent);if(this.progressMode==3){if(this.framePercent<this.percentFrom)l="";else if(this.framePercent>=0&&this.percentFrom<=this.framePercent&&this.framePercent<this.percentTo){var c=l.length;var h=(this.framePercent-this.percentFrom)/(this.percentTo-this.percentFrom);var p=Math.ceil(c*h);l=l.substr(0,p)}}this.textWidth=r.width*s;this.textHeight=r.height*o;this.processFlip(e,this.textWidth,this.textHeight);n(e,l,0,0,r.width*s,r.height*o,{align:r.textAlign,valign:r.textVAlign,mode:"stroke",overflow:"display"});if(t==0)n(e,l,0,0,r.width*s,r.height*o,{align:r.textAlign,valign:r.textVAlign,mode:"fill",overflow:"display"});r.endX=r.startX+r.width;r.endY=r.startY+r.height;this.updateBoundRect();if(t==1&&(this.hitPos==Hanimation.HITTEST_FILLSTART||this.hitPos==Hanimation.HITTEST_FILLEND)){this.drawFillControls(e,false,true)}this.postDraw(e,t);e.restore()};Hanimation.Text.prototype.setScale=function(e,t,n){Hanimation.AniObject.prototype.setScale.call(this,e,t,n);if(n){var r=this.getParam();r.fontSize=r.fontSize*Math.max(e,t)}if(n)this.model=null;return true};Hanimation.Group=function(e,t){Hanimation.AniObject.call(this,e);if(e)e.type=Hanimation.SHAPE_GROUP;if(isDefined(this.dataRef)&&this.dataRef&&this.dataRef.param&&(!isDefined(this.dataRef.param.rawWidth)||!isDefined(this.dataRef.items))){this.dataRef.param.rawWidth=0;this.dataRef.param.rawHeight=0;this.dataRef.items=[]}this.editFillColor="#0000ff"};inherit(Hanimation.Group,Hanimation.AniObject);Hanimation.Group.prototype.addObject=function(e){var t=this.dataRef.items.length;var n=true;for(var r=0;r<t;r++){var i=this.dataRef.items[r];if(i.guid==e.dataRef.guid){n=false;break}}if(n)this.dataRef.items.push(e.dataRef)};Hanimation.Group.prototype.getNormPt=function(e,t){var n=this.getParam();var r=this.getLiveParam();var i=r.right-r.left;var s=r.bottom-r.top;var o=i/n.rawWidth;var u=s/n.rawHeight;gx=e*this.auxParam.scaleX-r.left;gy=t*this.auxParam.scaleY-r.top;if(Math.abs(n.rotate)>.001){var a=this.getRotationCenter(true);a.x*=this.auxParam.scaleX;a.y*=this.auxParam.scaleY;var f=rotatePoint(a.x,a.y,gx,gy,-n.rotate);gx=f.x;gy=f.y}gx=gx/o;gy=gy/u;if(n.hF)gx=n.rawWidth-gx;if(n.vF)gy=n.rawHeight-gy;return{x:gx,y:gy}};Hanimation.Group.prototype.hitTest=function(e,t,n){var r=n&16&&n&8;var i=r?Hanimation.HITTEST_NONE:Hanimation.AniObject.prototype.hitTest.call(this,e,t,n);if(r){var s=this.getNormPt(e,t);var o=this.dataRef.items.length;var u;this.nestedHitObject=null;for(var a=o-1;a>=0;a--){var f=this.dataRef.items[a];var l=getAniObject(f);u=l?l.hitTest(s.x,s.y,n):Hanimation.HITTEST_NONE;if(u!=Hanimation.HITTEST_NONE){this.nestedHitObject=l;break}}i=this.nestedHitObject?Hanimation.HITTEST_WITHIN:Hanimation.HITTEST_NONE}return i};Hanimation.Group.prototype.draw=function(e,t,n){var r=this.dataRef.items.length;var i;var s;var o=this.getParam();var s=this.getLiveParam();e.save();e.globalAlpha=this.locked?.3:g_alpha*o.alpha*this.auxParam.alpha;this.prepareRotate(e);var u=s.endX-s.startX;var a=s.endY-s.startY;var f=u/o.rawWidth;var l=a/o.rawHeight;e.translate(s.startX,s.startY);this.processFlip(e,u,a);if(n){var c=n.img;var h=n.offset;e.drawImage(c,0,0,c.width,c.height,-h,-h,u+h*2,a+h*2)}else{for(var p=0;p<r;p++){var d=this.dataRef.items[p];i=getAniObject(d);i.setScale(f,l);i.setAlpha(e.globalAlpha,false);i.draw(e,t)}this.postDraw(e,t)}e.restore()};Hanimation.Clip=function(e){Hanimation.Group.call(this,e);if(e)e.type=Hanimation.SHAPE_CLIP;else{this.dataRef.param.symbolId="";this.dataRef.param.offsetX=0;this.dataRef.param.offsetY=0}this.counter=0;this.realtime=true;this.bound=null;this.frameLen=0;this.activeSeg=null;this.dataRef.param.segments=[];this.dataRef.param.frameListeners={}};inherit(Hanimation.Clip,Hanimation.Group);Hanimation.Clip.prototype.setSegment=function(e,t){if(e&&e.length>0&&t){var n={name:e,options:JSON.clone(t)};this.dataRef.param.segments[e]=n}};Hanimation.Clip.prototype.playSegment=function(e){if(e&&e.length>0){this.activeSeg=this.dataRef.param.segments[e];if(this.activeSeg&&this.activeSeg.options){this.counter=this.activeSeg.options.from}}else this.activeSeg=null};Hanimation.Clip.prototype.setSymbol=function(e){this.dataRef.param.symbolId=e};Hanimation.Clip.prototype.setSync=function(e){this.dataRef.param.sync=e};Hanimation.Clip.prototype.setRealtime=function(e){this.realtime=e};Hanimation.Clip.prototype.setBound=function(e){this.bound=JSON.clone(e)};Hanimation.Clip.prototype.copyData=function(e){if(!e)return;if(this.dataRef==e)return;Hanimation.AniObject.prototype.copyData.call(this,e)};Hanimation.Clip.prototype.hitTest=function(e,t,n){var r=n&16&&n&8;this.nestedHitObject=null;var i=r?Hanimation.HITTEST_NONE:Hanimation.AniObject.prototype.hitTest.call(this,e,t,n);if(r){var s=this.getParam();var o=Symbol.getSymbolById(s.symbolId);if(o){if(!o.unzipped){HaniData.unzip(o);o.unzipped=true}var u=Symbol.getBound(o,true);var a=o.layers;var f=a.length;var l;var c;var h=this.getCurrentFrame(o,true);for(var p=0;p<f;p++){layer=a[p];l=layer.units.length;for(var d=0;d<l;d++){var v=layer.units[d];var m=v.objects.length;if(!(h>=v.frameStart&&h<v.frameStart+v.frameCount))continue;for(var g=m-1;g>=0;g--){var y=getAniObject(v.objects[g]);y.updateTweenedParam(v,h);var b=this.getNormPt(e,t);{var w=u.left;var E=u.top;b.x+=w;b.y+=E;hitRe=y?y.hitTest(b.x,b.y,n):Hanimation.HITTEST_NONE;if(hitRe!=Hanimation.HITTEST_NONE){this.nestedHitObject=y;c=true;break}}}}if(c)break}}i=this.nestedHitObject?Hanimation.HITTEST_WITHIN:Hanimation.HITTEST_NONE}return i};Hanimation.Clip.prototype.getOffset=function(e){return{left:left,top:top}};Hanimation.Clip.prototype.getCurrentFrame=function(e,t){var n=this.getParam();var r=!window.previewRender;var i=0;if(r){var s=Mugeda.getFrameLength(e.layers);if(n.sync)i=(window.currentFrame-this.frameId)%s;else{if(this.activeSeg){var o=this.activeSeg.options;from=parseInt(o.from);if(isNaN(from))from=0;from=Math.max(0,from);var u=parseInt(o.to);if(isNaN(u))u=s-1;u=Math.min(s-1,u);if(from>u)from=u;if(this.counter<from)this.counter=from;else if(this.counter>u){if(o.noLoop)this.counter=u;else this.counter=from}i=this.counter;if(!t)this.counter++}else{i=this.counter%s;if(!t)this.counter++}}}return i};Hanimation.Clip.prototype.draw=function(e,t){function r(e,t,r,i){var s={};var o;var u=e.canvas;var a={};a.layers=t;if(!a.objects){for(var f=a.layers.length-1;f>=0;f--){var l=a.layers[f];l.objs=[];var c=l.units.length;for(var h=0;h<c;h++){var p=l.units[h];var d=p.objects.length;if(p&&r>=p.frameStart&&r<p.frameStart+p.frameCount){if(p.audio){if(r==p.frameStart){var v=AudioCache.getAudio(p.id);if(v){if(v.currentTime)v.currentTime=0;try{v.play()}catch(m){}}}else if(r==p.frameStart+p.frameCount-1){var v=AudioCache.getAudio(p.id);if(v){try{v.pause()}catch(m){}}}}if(d){for(var g=0;g<d;g++){var y=getAniObject(p.objects[g]);y.locked=n.locked;y.updateTweenedParam(p,r);l.objs.push(p.objects[g]);var y=getAniObject(p.objects[g]);y.setScale(i.scaleX,i.scaleY);y.setAlpha(i.alpha,false)}}}}}}e.save();if(a.objects){for(var f=0;f<a.objects.length;f++){o=a.objects[f];o=getAniObject(o);o.draw(e,0)}}else{HaniMask.drawLayer(e,a.layers)}e.restore();return s}var n=this;e.save();this.drawMode=t;var i=this.getParam();var s=Symbol.getSymbolById(i.symbolId);if(!s)return;HaniData.unzip(s);var o=i;var u=Symbol.getBound(s,true);if(u.width==0||u.height==0){u.left=i.left;u.top=i.top;u.right=i.left+16;u.bottom=i.top+16;u.width=16;u.height=16}var a=JSON.stringify(u)!=JSON.stringify(this.bound);var f=!window.previewRender;if(!this.bound)this.setBound(u);if(a){var l=o.startX-o.offsetX;var c=o.startY-o.offsetY;var h=1;var p=1;if(i.rawWidth>0&&i.rawHeight>0){h=o.width/i.rawWidth;p=o.height/i.rawHeight}o.offsetX=u.left-s.cw/2;o.offsetY=u.top-s.ch/2;this.setBound(u);o.startX=l+o.offsetX;o.startY=c+o.offsetY;o.left=o.startX;o.top=o.startY;o.endX=o.startX+u.width*h;o.endY=o.startY+u.height*p;o.right=o.endX;o.bottom=o.endY;o.width=u.width*h;o.height=u.height*p;o.rawWidth=u.width;o.rawHeight=u.height}if(this.drawMode==1)g_alpha=.8;else g_alpha=1;e.globalAlpha=g_alpha*i.alpha*this.auxParam.alpha;this.prepareRotate(e);var d=o.width*this.auxParam.scaleX;var v=o.height*this.auxParam.scaleY;var m=d/i.rawWidth;var g=v/i.rawHeight;var y=u.left*m;var b=u.top*g;e.translate(o.startX-y,o.startY-b);e.save();this.processFlip(e,i.width,i.height,y,b);var w=this.getCurrentFrame(s);if(w>=0){if(this.eventListeners&&this.eventListeners.enterframe){for(var E=0;E<this.eventListeners.enterframe.length;E++){this.eventListeners.enterframe[E].call(this,w);if(!this.eventListeners.enterframe)break}}var S={alpha:e.globalAlpha,scaleX:m,scaleY:g};r(e,s.layers,w,S)}e.restore();if(!f&&!Mugeda.cleanRender){var x=window.aniData.width*m/2;var T=window.aniData.height*g/2;var N=4;e.strokeStyle="#000";e.beginPath();e.moveTo(x-N,T);e.arc(x,T,N,0,Math.PI*2,false);e.stroke();e.globalAlpha=.5;e.beginPath();e.moveTo(x,T-N);e.lineTo(x,T+N);e.stroke()}this.postDraw(e,t);e.restore()};var TWEEN=TWEEN||function(){var e,t,n,r,i=[];return{start:function(e){n=setInterval(this.update,1e3/(e||60))},stop:function(){clearInterval(n)},add:function(e){i.push(e)},getAll:function(){return i},removeAll:function(){i=[]},remove:function(t){e=i.indexOf(t);if(e!==-1){i.splice(e,1)}},update:function(){e=0;t=i.length;r=(new Date).getTime();while(e<t){if(i[e].update(r)){e++}else{i.splice(e,1);t--}}}}}();TWEEN.Tween=function(e){var t=e,n={},r={},i={},s=1e3,o=0,u=null,a=TWEEN.Easing.Linear.EaseNone,f=null,l=null,c=null;this.to=function(e,n){if(n!==null){s=n}for(var r in e){if(t[r]===null){continue}i[r]=e[r]}return this};this.start=function(){TWEEN.add(this);u=(new Date).getTime()+o;for(var e in i){if(t[e]===null){continue}n[e]=t[e];r[e]=i[e]-t[e]}return this};this.stop=function(){TWEEN.remove(this);return this};this.delay=function(e){o=e;return this};this.easing=function(e){a=e;return this};this.chain=function(e){f=e};this.onUpdate=function(e){l=e;return this};this.onComplete=function(e){c=e;return this};this.getFactor=function(e){var t,n,r;n=Math.min(1,Math.max(0,e));r=a(n);return r};this.update=function(e){var i,o,h;if(e<u){return true}o=(e-u)/s;o=o>1?1:o;h=a(o);for(i in r){t[i]=n[i]+r[i]*h}if(l!==null){l.call(t,h)}if(o==1){if(c!==null){c.call(t)}if(f!==null){f.start()}return false}return true}};TWEEN.Easing={Linear:{},Step:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};TWEEN.Easing.Linear.EaseNone=function(e){return e};TWEEN.Easing.Step.EaseIn=function(e){return 1};TWEEN.Easing.Step.EaseOut=function(e){return 0};TWEEN.Easing.Quartic.EaseIn=function(e){return e*e*e*e};TWEEN.Easing.Quartic.EaseOut=function(e){return-(--e*e*e*e-1)};TWEEN.Easing.Quartic.EaseInOut=function(e){if((e*=2)<1)return.5*e*e*e*e;return-.5*((e-=2)*e*e*e-2)};TWEEN.Easing.Elastic.EaseIn=function(e){var t,n=.1,r=.25;if(e==0)return 0;if(e==1)return 1;if(!r)r=.3;if(!n||n<1){n=1;t=r/4}else t=r/(2*Math.PI)*Math.asin(1/n);return-(n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r))};TWEEN.Easing.Elastic.EaseOut=function(e){var t,n=.1,r=.25;if(e==0)return 0;if(e==1)return 1;if(!r)r=.3;if(!n||n<1){n=1;t=r/4}else t=r/(2*Math.PI)*Math.asin(1/n);return n*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/r)+1};TWEEN.Easing.Elastic.EaseInOut=function(e){var t,n=.1,r=.25;if(e==0)return 0;if(e==1)return 1;if(!r)r=.3;if(!n||n<1){n=1;t=r/4}else t=r/(2*Math.PI)*Math.asin(1/n);if((e*=2)<1)return-.5*n*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/r);return n*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/r)*.5+1};TWEEN.Easing.Back.EaseIn=function(e){var t=1.70158;return e*e*((t+1)*e-t)};TWEEN.Easing.Back.EaseOut=function(e){var t=1.70158;return(e=e-1)*e*((t+1)*e+t)+1};TWEEN.Easing.Back.EaseInOut=function(e){var t=1.70158*1.525;if((e*=2)<1)return.5*e*e*((t+1)*e-t);return.5*((e-=2)*e*((t+1)*e+t)+2)};TWEEN.Easing.Bounce.EaseIn=function(e){return 1-TWEEN.Easing.Bounce.EaseOut(1-e)};TWEEN.Easing.Bounce.EaseOut=function(e){if((e/=1)<1/2.75){return 7.5625*e*e}else if(e<2/2.75){return 7.5625*(e-=1.5/2.75)*e+.75}else if(e<2.5/2.75){return 7.5625*(e-=2.25/2.75)*e+.9375}else{return 7.5625*(e-=2.625/2.75)*e+.984375}};TWEEN.Easing.Bounce.EaseInOut=function(e){if(e<.5)return TWEEN.Easing.Bounce.EaseIn(e*2)*.5;return TWEEN.Easing.Bounce.EaseOut(e*2-1)*.5+.5};Zoom={setZoomInfo:function(e,t,n){if(!n)return;var r=0;r=t+1;e.zoomInfo[r]=JSON.clone(n)},updateLayersAfterZoom:function(e,t){var n=e;var r=n.length;for(var i=0;i<r;i++){var s=n[i];var o=n[i].units;var u=o.length;for(var a=0;a<u;a++){var f=o[a];var l=f.objects;var c=l.length;for(var h=0;h<c;h++){var p=l[h];var d=getAniObject(p);if(d){d.setScale(t,t,true)}var v=f.keyframes;var m=v.length;for(var g=0;g<m;g++){var y=v[g];Param.scale(y.param,t,t)}}if(f.animated&&f.path){var b={guid:f.guidPath};var w=getAniObject(b);if(w){w.setScale(t,t,true);syncAnimationPath(f,w)}}}}},updateDataAfterZoom:function(e,t){this.updateLayersAfterZoom(e.layers,t)},objectInScene:function(e,t,n,r){var i=e.getParam();var s=typeof i.offsetX!="undefined"?-i.offsetX:0;var o=typeof i.offsetY!="undefined"?-i.offsetY:0;var u=i.right+s<t.offsetLeft-Hanimation.PADDING||i.left+s>t.offsetLeft+n+Hanimation.PADDING||i.bottom+o<t.offsetTop-Hanimation.PADDING||i.top+o>t.offsetTop+r+Hanimation.PADDING;return!u},removeZoomInfo:function(e,t){var n=e.zoomInfo;var r=false;t++;for(index in n){if(index==t){delete n[index];r=true;break}}return r},getZoomInfo:function(e,t,n){var r=null;if(t==-1){r=JSON.clone(e.zoomInfo[0]);r.type=0;return r}var i=e.zoomInfo;t++;var s=-1;var o=-1;for(p in i){if(!i[p])continue;if(p==t){r=i[p];r.type=1;break}if(p<t)s=p;else if(p>t){o=p;break}}if(!r){var u=parseInt(s);var a=parseInt(o);var f="None";if(s>=0)f=i[s].tween||"None";if(n==1){r=u>=0?JSON.clone(i[s]):null;r.type=2}else if(n==2){if(u==t||u==0&&t==1){r=JSON.clone(i[s]);r.type=3}}else if(u>=0&&(a<0||f=="None")){r=JSON.clone(i[s]);r.type=4}else if(u>=0&&a>u&&f!="None"){r={zoomLevel:1,offsetLeft:0,offsetTop:0,tween:f,rotation:0};var l=i[s];var c=i[o];if(u==0)u=1;var h=a-u;var p=t-u;var d=getTweenFactors(h,r.tween)[p];var v=1/l.zoomLevel;var m=1/c.zoomLevel;var g=v+d*(m-v);var y=1/g;r.zoomLevel=y;r.offsetLeft=l.offsetLeft+d*(c.offsetLeft-l.offsetLeft);r.offsetTop=l.offsetTop+d*(c.offsetTop-l.offsetTop);r.rotation=l.rotation+d*(c.rotation-l.rotation);r.type=5}}if(r&&r.rotation==undefined)r.rotation=0;return r}};var built=false;HaniMask={zoomInfo:null,drawLayer:function(e,t,n,r){function i(e){var t=false;if(e.items&&e.items.length){for(var n=0;n<e.items.length;n++){t=i(e.items[n]);if(t)break}}else if(e.type==Hanimation.SHAPE_CLIP||e.type==Hanimation.SHAPE_TEXT){t=true}return t}function s(e){if(!e||!e.objects)return false;var t=false;var n=e.objects.length;for(var r=0;r<n;r++){var s=e.objects[r];if(i(s)){t=true;break}}return t}var o;var u;var a;var f;var r=r==undefined?0:r;var l=r&1;var c=r&2;zoomInfo=n;var h=e.canvas.width;var p=e.canvas.height;if(zoomInfo){zoomInfo.left=Math.round(zoomInfo.offsetLeft*(c?1:zoomInfo.zoomLevel));zoomInfo.top=Math.round(zoomInfo.offsetTop*(c?1:zoomInfo.zoomLevel))}else{zoomInfo={};zoomInfo.left=0;zoomInfo.top=0}zoomInfo.width=h;zoomInfo.height=p;for(var d=t.length-1;d>=0;d--){f=t[d];if(f.hide&&l)continue;u=f.objs;if(!f.maskMode){unit=f.unit||{};var v=s(unit);var m=v||unit.pg||Math.abs(zoomInfo.zoomLevel-1)>.01;cache=m?null:ObjectCache.getCache(unit.id||"");if(cache){if(unit.animated){o=unit.objects;if(o.length){o=getAniObject(o[0]);o.draw(e,0,cache)}}else{var g=cache.img;var y=cache.bound;e.drawImage(g,y.left,y.top)}}else{for(var b=0;b<u.length;b++){o=u[b];o=getAniObject(o);o.draw(e,0)}}delete f.unit}else{if(f.maskMode==2){while(a=t[d-1]){if(a.maskMode==2){u=u.concat(a.objs);delete a.objs;d--}else if(a.maskMode==1){HaniMask.draw(e,u,a.objs);delete a.objs;d--;break}else{break}}}}delete f.objs}},draw:function(e,t,n){var r=this.getContext(e);var i=this.getBoundary(r.mask,n);var s=this.getBoundary(r.masked,t);var o=s;if(o.left<i.left)o.left=i.left;if(o.top<i.top)o.top=i.top;if(o.right>i.right)o.right=i.right;if(o.bottom>i.bottom)o.bottom=i.bottom;o.left=parseInt(o.left);o.top=parseInt(o.top);o.right=parseInt(o.right);o.bottom=parseInt(o.bottom);o.width=o.right-o.left;o.height=o.bottom-o.top;if(o.width==0||o.height==0)return;var u=r.mask.getImageData(o.left-zoomInfo.left,o.top-zoomInfo.top,o.width,o.height);var a=r.masked.getImageData(o.left-zoomInfo.left,o.top-zoomInfo.top,o.width,o.height);var f=u.data;var l=a.data;var c=1/255;for(var h=0;h<f.length;h+=4){l[h+3]=f[h+3]*l[h+3]*c}var p=r.mask.canvas;p.width=o.width;p.height=o.height;r.mask.putImageData(a,0,0);e.drawImage(p,o.left,o.top)},getContext:function(e){var t=e.canvas;var n=t.width;var r=t.height;var i=G("maskPannel");if(!i){i=document.createElement("div");i.id="maskPannel";i.style.display="none";i.innerHTML="<canvas></canvas><canvas></canvas>";document.body.appendChild(i)}var s=i.childNodes[0];var o=i.childNodes[1];s.width=o.width=n;s.height=o.height=r;return{mask:s.getContext("2d"),masked:o.getContext("2d")}},getBoundary:function(e,t){var n=e.canvas;var r=n.width;var i=n.height;var s;var o;var u;var a=4;var f=zoomInfo.left;var l=zoomInfo.top;var c=zoomInfo.left+zoomInfo.width;var h=zoomInfo.top+zoomInfo.height;var p={left:c,top:h,right:f,bottom:l};var d;for(var v=0;v<t.length;v++){n=t[v];o=n.param;aniobj=getAniObject(n);d=aniobj.getBoundRect();u=o.lineWidth||1;s={left:d.left-u,top:d.top-u,right:d.right+u,bottom:d.bottom+u};if(s.left<p.left)p.left=s.left;if(s.right>p.right)p.right=s.right;if(s.top<p.top)p.top=s.top;if(s.bottom>p.bottom)p.bottom=s.bottom;n=getAniObject(n);e.save();e.translate(-zoomInfo.left,-zoomInfo.top);n.draw(e,0);e.restore()}p.left-=a;p.top-=a;p.right+=a;p.bottom+=a;if(p.left>p.right)p.left=p.right;if(p.top>p.bottom)p.top=p.bottom;if(p.left<f)p.left=f;if(p.top<l)p.top=l;if(p.right>c)p.right=c;if(p.bottom>h)p.bottom=h;return p}};var ObjectCache={hash:{},count:0,counter:0,cacheAmount:0,onCached:null,init:function(e,t){if(!e.cM){t();return}this.initCanvas(e);if(!window.built){built=true;e.layers=buildLayers(e.layers);for(var n=0;n<e.symbols.length;n++){e.symbols[n].layers=buildLayers(e.symbols[n].layers)}}var r=e.layers;for(var i=r.length-1;i>=0;i--){var s=r[i].units;for(var o=0;o<s.length;o++){if(s[o].objects.length){this.cacheUnit(s[o]);this.cacheAmount++}}}var u=e.symbols;for(var n=0;n<u.length;n++){r=u[n].layers;for(var i=r.length-1;i>=0;i--){var s=r[i].units;for(var o=0;o<s.length;o++){if(s[o].objects.length){this.cacheUnit(s[o]);this.cacheAmount++}}}}onCached=t},initCanvas:function(e){this.width=e.width||600;this.height=e.height||400;var t=document.createElement("canvas");document.body.appendChild(t);t.width=this.width;t.height=this.height;t.style.position="absolute";t.style.left="50px";t.style.top="50px";t.style.display="none";this.ctx=t.getContext("2d");var n=t.cloneNode(true);document.body.appendChild(n);this.ctxmin=n.getContext("2d")},getMaxSize:function(e){var t={width:0,height:0};var n=e.keyframes;for(var r=0;r<n.length;r++){var i=n[r].param;if(i.width>t.width)t.width=i.width;if(i.height>t.height)t.height=i.height}return t},getMaxLineWidth:function(e){var t=0;if(t<e.param.lineWidth)t=e.param.lineWidth;var n=e.items||[];if(n.length){for(var r in n){var i=n[r];var s=this.getMaxLineWidth(i);if(t<s)t=s}}return t},getUnitGuid:function(e){var t=""+(e.id||"");if(t.length<5){t+="_"+e.layerId}return t},cacheUnit:function(e){var t=this.getUnitGuid(e);if(!t||this.hash[t])return;this.ctx.clearRect(0,0,this.width,this.height);var n={left:Hanimation.MAX_VALUE,top:Hanimation.MAX_VALUE,right:-Hanimation.MAX_VALUE,bottom:-Hanimation.MAX_VALUE};var r=e.objects;var i=0;this.ctx.save();var s=false;for(var o=0;o<r.length;o++){var u=r[o];if(u.type==Hanimation.SHAPE_CLIP||u.type==Hanimation.SHAPE_TEXT||u.type==Hanimation.SHAPE_PICTURE){s=true}}for(var o=0;o<r.length;o++){var u=r[o];if(e.animated){var a=this.getMaxSize(e);u.param.width=a.width;u.param.right=u.param.left+u.param.width;u.param.endX=u.param.right;u.param.height=a.height;u.param.bottom=u.param.top+u.param.height;u.param.endY=u.param.bottom;a=this.getMaxLineWidth(u);u.param.lineWidth=a;u.param.alpha=1;u.param.rotate=0}var f=getAniObject(u);var l=f.getBoundRect();i=Math.ceil(1+(u.param.lineWidth||1)/2);var c=l.left-i;var h=l.top-i;var p=l.right+i;var d=l.bottom+i;if(n.left>c)n.left=c;if(n.top>h)n.top=h;if(n.right<p)n.right=p;if(n.bottom<d)n.bottom=d}n.left=Math.floor(n.left);n.top=Math.floor(n.top);n.right=Math.ceil(n.right);n.bottom=Math.ceil(n.bottom);if(!e.animated){if(n.left<0)n.left=0;if(n.top<0)n.top=0;if(n.right>this.width)n.right=this.width;if(n.bottom>this.height)n.bottom=this.height}n.width=n.right-n.left;n.height=n.bottom-n.top;var v=this.ctx.canvas;v.width=n.width;v.height=n.height;var m=v.height==0||v.width==0;this.ctx.translate(-n.left,-n.top);for(var o=0;o<r.length;o++){var u=r[o];var f=getAniObject(u);f.draw(this.ctx,0)}this.ctx.restore();var g=new Image;if(m)g.src=Mugeda.emptyImg;else g.src=this.ctx.canvas.toDataURL("image/png");g.onload=function(){ObjectCache.hash[t]={img:this,bound:n,offset:i};ObjectCache.counter++;if(ObjectCache.cacheAmount==ObjectCache.counter&&typeof onCached!="undefined"&&onCached!=null)setTimeout(onCached);if(typeof LoadingProcess!="undefined")LoadingProcess.updateTo(100+Math.floor(0*ObjectCache.counter/ObjectCache.cacheAmount),"Loading...")};if(s){for(var o=0;o<r.length;o++){var u=r[o];if(!(u.type==Hanimation.SHAPE_CLIP||u.type==Hanimation.SHAPE_TEXT||u.type==Hanimation.SHAPE_PICTURE)){this.cacheObject(u)}}}},cacheObject:function(e){var t=e.guid;if(!t||this.hash[t])return;var n=getAniObject(e);this.ctx.clearRect(0,0,this.width,this.height);n.draw(this.ctx,0);var r=n.getBoundRect();var i=1+(e.param.lineWidth||1)/2;var s={left:r.left-i,top:r.top-i,right:r.right+i,bottom:r.bottom+i};if(s.left<0)s.left=0;if(s.top<0)s.top=0;if(s.right>this.width)s.right=this.width;if(s.bottom>this.height)s.bottom=this.height;s.width=s.right-s.left;s.height=s.bottom-s.top;var o=this.ctxmin;var u=o.canvas;u.width=s.width;u.height=s.height;o.drawImage(this.ctx.canvas,s.left,s.top,s.width,s.height,0,0,s.width,s.height);var a=new Image;a.src=u.toDataURL("image/png");a.onload=function(){ObjectCache.hash[t]={img:this,bound:s,offset:i}}},getCache:function(e){return this.hash[e]}};Symbol={imageCache:{},symbolCache:{},paramCache:{},build:function(e,t){var n=0;var r=0;var i=function(){n++;if(n>=r&&t){t()}};r=this.builds(e||[]);t()},builds:function(e,t){var n;var r=0;var i=e.length;if(!i){if(t)t();return 0}for(var s=0;s<i;s++){n=e[s];n.layers=buildLayers(n.layers||[]);r++}return i},updateImage:function(e,t){var n=this;if(!e||!e.layers||!e.layers.length)return;var r=this.getLayersObjects(e.layers);getThumbnail(r,function(e){if(t)t(e)})},getSymbolsByName:function(e){var t=[];var n=window.aniData.symbols||[];for(var r=0;r<n.length;r++){if(n[r].name==e)t.push(n[r])}return t},getSymbolById:function(e){var t=window.aniData.symbols||[];for(var n=0;n<t.length;n++){if(t[n].id==e)return t[n]}return null},getLayersObjects:function(e){var t=[];if(e){for(var n=e.length-1;n>=0;n--){var r=e[n].units;for(var i=0;i<r.length;i++){var s=r[i];var o=s.objects;for(var u=0;u<o.length;u++){t.push(o[u])}}}}return t},getBound:function(e,t){var n=this.paramCache[e.id];if(!n||e.dirtyFlag){var r=this.getLayersObjects(e.layers);n=this.getBoundary(r,t);this.paramCache[e.id]=n;e.dirtyFlag=false}return n},getBoundary:function(e,t){var n=Hanimation.MAX_VALUE;var r=Hanimation.MAX_VALUE;if(e.length==0)return{left:0,top:0,right:0,bottom:0,width:0,height:0};var i={left:n,top:r,right:0,bottom:0};for(var s=0;s<e.length;s++){var o=e[s];var u=o.param;var a=getAniObject(o);if(!a)continue;var f=a.getBoundRect();if(f.left<i.left)i.left=f.left;if(f.right>i.right)i.right=f.right;if(f.top<i.top)i.top=f.top;if(f.bottom>i.bottom)i.bottom=f.bottom}if(!t){if(i.left<0)i.left=0;if(i.top<0)i.top=0;if(i.right>n)i.right=n;if(i.bottom>r)i.bottom=r}i.width=i.right-i.left;i.height=i.bottom-i.top;return i}};ImageCache={images:{},init:function(e,t){function o(){if(this.guid){var e=this.object.param;e.rawWidth=this.width;e.rawHeight=this.height;i[this.guid]=this}n++;var o=35;if(typeof LoadingProcess!="undefined")LoadingProcess.updateTo(65+Math.floor(o*n/r),"Loading...");if(n==r)t(s)}function u(){if(this.guid)i[this.guid]=this;if(this.object){var e=this.object.param.imageSrc=="res/noimage.png";this.object.param.imageSrc=e?Mugeda.emptyImg:"res/noimage.png";this.src=this.object.param.imageSrc}n++;s++;var o=35;if(typeof LoadingProcess!="undefined")LoadingProcess.updateTo(65+Math.floor(o*n/r),"Loading...");if(n==r)t(s)}var n=0;var r=0;var i=this.images;var s=0;var a=e.layers;for(var f=a.length-1;f>=0;f--){var l=a[f].units;for(var c=0;c<l.length;c++){var h=l[c].objects;for(var p=0;p<h.length;p++){var d=h[p];r+=loadObjectImage(d,o,u)}}}var v=e.symbols;for(var m=0;m<v.length;m++){var a=v[m].layers;for(var f=a.length-1;f>=0;f--){var l=a[f].units;for(var c=0;c<l.length;c++){var h=l[c].objects;for(var p=0;p<h.length;p++){var d=h[p];r+=loadObjectImage(d,o,u)}}}}if(r==0)t()},updateImage:function(e,t){this.images[e]=t},getImage:function(e){return this.images[e]}};AudioCache={audios:{},init:function(e,t){var n=navigator.userAgent.match(/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/i)!=null;var r=0;var i=0;var s=e.layers;var o=[];for(var u=s.length-1;u>=0;u--){var a=s[u].units;for(var f=0;f<a.length;f++){var l=a[f];if(l.audio){r++;o.push(l)}}}for(u=0;u<r;u++){var l=o[u];if(l.audio){var c=new Audio;c.preload=true;c.src=l.audio;if(n){i++;if(i==r)t()}else{c.addEventListener("loadedmetadata",function(){i++;if(typeof LoadingProcess!="undefined")LoadingProcess.updateTo(50+Math.floor(15*i/r),"Loading...");if(i==r)t()});document.body.appendChild(c)}this.audios[l.id]=c}}if(r==0)t()},getAudio:function(e){return this.audios[e]},updateAudio:function(e,t){this.audios[e]=t}};Bezier={Point:function(e,t,n,r,i,s){this.nodeX=e;this.nodeY=t;this.forwardX=n;this.forwardY=r;this.backwardX=i;this.backwardY=s},interpolate:function(e,t,n,r,i,s){return bezierInterpolate(e,t,n,r,i,s)},getPoint:function(e,t,n){return bezierGetPoint(e,t,n)},getLinePt:function(e,t,n,r,i){var s=n-e;var o=t-r;return[e+s*i,t-o*i]},getBezierObj:function(e,t,n){var r=this.getLinePt(e.nodeX,e.nodeY,e.forwardX,e.forwardY,n);var i=this.getLinePt(e.forwardX,e.forwardY,t.backwardX,t.backwardY,n);var s=this.getLinePt(t.backwardX,t.backwardY,t.nodeX,t.nodeY,n);var o=this.getLinePt(r[0],r[1],i[0],i[1],n);var u=this.getLinePt(i[0],i[1],s[0],s[1],n);var a=this.getLinePt(o[0],o[1],u[0],u[1],n);return{point:{nodeX:a[0],nodeY:a[1],forwardX:u[0],forwardY:u[1],backwardX:o[0],backwardY:o[1]},forward:{x:r[0],y:r[1]},backward:{x:s[0],y:s[1]}}},getDistance:function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},splitCurve:function(e,t){var n;var r;var i;var s;var o;var u={};var a=e.length;if(!t)t=2;for(var f=0;f<a;f++){i=e[f],s=e[f+1==a?0:f+1];n=this.getBezierObj(i,s,.5).point;o=Math.round(t*(Math.sqrt(Math.pow(i.nodeX-n.nodeX,2)+Math.pow(i.nodeY-n.nodeY,2))+Math.sqrt(Math.pow(n.nodeX-s.nodeX,2)+Math.pow(n.nodeY-s.nodeY,2))));for(var l=0;l<o;l++){n=this.getBezierObj(i,s,l/o);r=Math.round(n.point.nodeX)+","+Math.round(n.point.nodeY);if(u[r])continue;n.index=f;n.ratio=l/o;u[r]=n}}return u},removeVertex:function(e,t){t.splice(e,1)},subDivision2:function(e,t,n){function r(e,t,n){var r=e+n*(t-e);return r}points=e;var i=points.length;var s=t;var o=t+1;if(o==i)o=0;var u=Bezier.getPoint(points[s],points[o],n);var a={},f={},l={},c={};a.x=r(points[s].nodeX,points[s].forwardX,n);a.y=r(points[s].nodeY,points[s].forwardY,n);f.x=r(points[o].backwardX,points[o].nodeX,n);f.y=r(points[o].backwardY,points[o].nodeY,n);var h=r(points[s].forwardX,points[o].backwardX,n);var p=r(points[s].forwardY,points[o].backwardY,n);var c;c.backwardX=r(a.x,h,n);c.backwardY=r(a.y,p,n);c.forwardX=r(h,f.x,n);c.forwardY=r(p,f.y,n);c.nodeX=r(c.backwardX,c.forwardX,n);c.nodeY=r(c.backwardY,c.forwardY,n);e[s].forwardX=a.x;e[s].forwardY=a.y;e[o].backwardX=f.x;e[o].backwardY=f.y;if(t==i-1)points.push(c);else points.splice(o,0,c)},subDivision:function(e,t,n){var r=t;var i=n;var s=i+1;if(s==e.length)s=0;e[i].forwardX=r.forward.x;e[i].forwardY=r.forward.y;e[s].backwardX=r.backward.x;e[s].backwardY=r.backward.y;r=r.point;r=new this.Point(r.nodeX,r.nodeY,r.forwardX,r.forwardY,r.backwardX,r.backwardY);e.splice(i+1,0,r)},isInPath:function(e,t,n){var r=[0,0,0,0];var i=[0,0,0,0];var s=Hanimation.MAX_VALUE;var o={x:e,y:t};var u=[{x:0,y:s},{x:0,y:s*-1},{x:s,y:0},{x:s*-1,y:0}];var a;var f;var l;var c;n=this.cut(n);for(var h=0;h<n.length;h++){l=n[h];c=n[h==n.length-1?0:h+1];a={x:l.nodeX,y:l.nodeY};f={x:c.nodeX,y:c.nodeY};if(this.getcross(o,u[0],a,f))r[0]++;if(this.getcross(o,u[1],a,f))r[1]++;if(this.getcross(o,u[2],a,f))r[2]++;if(this.getcross(o,u[3],a,f))r[3]++}return Math.min(r[0],r[1],r[2],r[3])%2},isOnBezier:function(e,t,n,r){var i;var s;var e=Math.round(e);var t=Math.round(t);var o=Math.round(2*Math.sqrt(Math.pow(n.nodeX-r.nodeX,2)+Math.pow(n.nodeY-r.nodeY,2)));for(var u=0;u<o;u++){s=u/o;i=this.getBezierObj(n,r,s);if(Math.round(i.point.nodeX)==e&&Math.round(i.point.nodeY)==t){i.ratio=s;return i}}},hitTest:function(e,t,n){var r=this.isInPath(e,t,n);var i;var s=4;var o=n.length;for(var u=0;u<2;u++){for(var a=0;a<2;a++){i=this.isInPath(e+s*(u?1:-1),t+s*(a?1:-1),n);if(i!=r)break}if(i!=r)break}if(i==r)return{mode:0};for(var u=0;u<o;u++){i=n[u];i={x:i.nodeX,y:i.nodeY};if(i.x>=e-s&&i.x<=e+s&&i.y>=t-s&&i.y<=t+s){return{mode:1,point:i,index:u,curve:n}}}for(var u=-s;u<=s;u++){for(var a=-s;a<=s;a++){for(var f=0;f<o;f++){if(i=this.isOnBezier(e+u,t+a,n[f],n[f==o-1?0:f+1])){return{mode:2,point:{x:e+u,y:t+a},index:f,data:i,curve:n}}}}}return{mode:0}},getBoundary:function(e){var t;var n;var r;var i;var s;while(t=e.pop()){t=this.cut(t);for(var o in t){n=t[o];r=n.nodeX;i=n.nodeY;if(!s)s={top:i,right:r,bottom:i,left:r};if(i<s.top)s.top=i;if(i>s.bottom)s.bottom=i;if(r<s.left)s.left=r;if(r>s.right)s.right=r}}return s},multiply:function(e,t,n){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)},iscross:function(e,t,n,r){return Math.max(e.x,t.x)>=Math.min(n.x,r.x)&&Math.max(n.x,r.x)>=Math.min(e.x,t.x)&&Math.max(e.y,t.y)>=Math.min(n.y,r.y)&&Math.max(n.y,r.y)>=Math.min(e.y,t.y)&&this.multiply(n,t,e)*this.multiply(t,r,e)>=0&&this.multiply(e,r,n)*this.multiply(r,t,n)>=0},getcross:function(e,t,n,r){if(this.iscross(e,t,n,r)){return{x:((t.x-e.x)*(n.x-r.x)*(n.y-e.y)-n.x*(t.x-e.x)*(n.y-r.y)+e.x*(t.y-e.y)*(n.x-r.x))/((t.y-e.y)*(n.x-r.x)-(t.x-e.x)*(n.y-r.y)),y:((t.y-e.y)*(n.y-r.y)*(n.x-e.x)-n.y*(t.y-e.y)*(n.x-r.x)+e.y*(t.x-e.x)*(n.y-r.y))/((t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x))}}},slope:function(e,t){var n=t.x-e.x;var r=t.y-e.y;var i=Math.sqrt(Math.pow(n,2)+Math.pow(r,2));return Math.asin(n/i)*180/Math.PI||0},angle:function(e,t,n,r){return Math.abs(this.slope(e,t)-this.slope(n,r))},isrep:function(e,t,n,r){return(t.y-e.y)*(n.x-r.x)==(t.x-e.x)*(n.y-r.y)},nearest:function(e,t,n,r){var i=this.cuts(e,t,.5);var s=this.cuts(n,r,.5);i.unshift(e);s.unshift(n);i.push(t);s.push(r);var o;var u;var a;var f;for(var l=0;l<i.length;l++){for(var c=0;c<s.length;c++){u=this.getDistance({x:i[l].nodeX,y:i[l].nodeY},{x:s[c].nodeX,y:s[c].nodeY});if(!o)o=u;if(u<o){o=u;a=i[l];f=s[c];a.cross=f;f.cross=a}}}return[a,f]},getnear:function(e,t,n){var r;var i;var s=1;var o;var u=.5;var a=.5;var f={x:e.nodeX,y:e.nodeY};while(true){if(++s>=1e3)break;r=this.getBezierObj(e,t,a);i=r.point;o={x:i.nodeX,y:i.nodeY};if(this.getDistance(n,o)<.1){r=new this.Point(i.nodeX,i.nodeY,i.forwardX,i.forwardY,i.backwardX,i.backwardY);r.ratio=a;r.index=e.index;return r}u=u*.5;a+=u*(this.getDistance(n,f)<=this.getDistance(o,f)?-1:1)}},extend:function(e,t){var n=[this.cut(e),this.cut(t)];var r=n[0].length;var i=n[1].length;var s;var o;var u;var a;var f;var l;var c;var h;var p;var d;var v;var m;var g;var y;var b=[[],[]];for(var w=0;w<r;w++){for(var E=0;E<i;E++){d=n[0][w];v=n[0][w==r-1?0:w+1];m=n[1][E];g=n[1][E==i-1?0:E+1];f={x:d.nodeX,y:d.nodeY};l={x:v.nodeX,y:v.nodeY};c={x:m.nodeX,y:m.nodeY};h={x:g.nodeX,y:g.nodeY};if(p=this.iscross(f,l,c,h)){if(this.isrep(f,l,c,h)){h=this.getnear(d,v,h);f=this.getnear(m,g,f);f.nodeX=d.nodeX;f.nodeY=d.nodeY;h.nodeX=g.nodeX;h.nodeY=g.nodeY;e[w].cross=f;f.cross=e[w];t[E==i-1?0:E+1].cross=h;h.cross=t[E==i-1?0:E+1];b[0].push(h);b[1].push(f);b[0].splice(1,2);b[1].splice(1,2)}else{if(p=this.nearest(d,v,m,g)){for(var S=0;S<=1;S++){c=b[S];l=0;for(var x=0;x<c.length;x++){if(c[x].index==p[S].index&&c[x].ratio>p[S].ratio){c.splice(x,0,p[S]);l=1;break}}if(!l)b[S].push(p[S])}}}}}}for(var S=0;S<=1;S++){y=S?t:e;s=0;for(var w=0;w<y.length;w++){d=y[w];v=y[w==y.length-1?0:w+1];for(var E=0;E<b[S].length;E++){c=b[S][E];if(this.getDistance({x:d.nodeX,y:d.nodeY},{x:c.nodeX,y:c.nodeY})<.5){d.cross=c.cross;c.cross.cross=d;b[S].splice(E,1);continue}if(this.getDistance({x:v.nodeX,y:v.nodeY},{x:c.nodeX,y:c.nodeY})<.5){v.cross=c.cross;c.cross.cross=v;b[S].splice(E,1);continue}if(c.index==s){p=this.getBezierObj(d,v,d.ratio?(c.ratio-d.ratio)/(1-d.ratio):c.ratio);d.forwardX=p.forward.x;d.forwardY=p.forward.y;v.backwardX=p.backward.x;v.backwardY=p.backward.y;p=p.point;c.forwardX=p.forwardX;c.forwardY=p.forwardY;c.backwardX=p.backwardX;c.backwardY=p.backwardY;y.splice(w+1,0,c);b[S].splice(E,1);s--}}s++}}for(var S=0;S<=1;S++){y=S?t:e;for(var w=0;w<y.length;w++){c=y[w];c.next=y[w==y.length-1?0:w+1];c.prev=y[(w||y.length)-1];delete c.index;delete c.ratio}}return[e,t]},cut:function(e){var t;var n;var r;var i;var s=[];var o=0;var u=e.length;for(var a=0;a<u;a++){n=e[a];n=new this.Point(n.nodeX,n.nodeY,n.forwardX,n.forwardY,n.backwardX,n.backwardY);s.push(n)}for(var a=0;a<u;a++){t=a+1;if(t==u)t=0;r=s[a];i=s[t];r.index=o++;n=this.cuts(r,i);if(t=n.length){for(var f=0;f<t;f++){s.splice(a+f+1,0,n[f])}u+=t;a+=t}}return s},cuts:function(e,t,n){var r;var i;var s=[e,t];var o=2;for(var u=0;u<o-1;u++){e=s[u];t=s[u+1];if(i=this.put(e,t,n)){e.forwardX=i.forward.x;e.forwardY=i.forward.y;t.backwardX=i.backward.x;t.backwardY=i.backward.y;i=i.point;i=new this.Point(i.nodeX,i.nodeY,i.forwardX,i.forwardY,i.backwardX,i.backwardY);i.ratio=((e.ratio||0)+(t.ratio||1))/2;i.index=e.index;s.splice(u+1,0,i);o++;u--}}s.pop();s.shift();return s},put:function(e,t,r){var i;var s=this.getDistance({x:e.nodeX,y:e.nodeY},{x:t.nodeX,y:t.nodeY});if(s<.5)return;if(r&&s>r)i=1;if(!i){p={x:e.nodeX,y:e.nodeY};q={x:t.nodeX,y:t.nodeY};m={x:e.forwardX,y:e.forwardY};n={x:t.backwardX,y:t.backwardY};if(p.x==m.x&&p.y==m.y&&q.x==n.x&&q.y==n.y)return;if(this.getcross(p,q,m,n))i=1}if(!i){if(this.angle(p,q,p,m)+this.angle(q,p,q,n)>10)i=1}if(i)return this.getBezierObj(e,t,.5)},isCross:function(e,t){var n=[this.cut(e),this.cut(t)];var r=n[0].length;var i=n[1].length;var s;var o;var u;var a;var f;var l;var c;var h;var p;for(var d=0;d<r;d++){for(var v=0;v<i;v++){l=n[0][d];c=n[0][d==r-1?0:d+1];h=n[1][v];p=n[1][v==i-1?0:v+1];s={x:l.nodeX,y:l.nodeY};o={x:c.nodeX,y:c.nodeY};u={x:h.nodeX,y:h.nodeY};a={x:p.nodeX,y:p.nodeY};if(this.getcross(s,o,u,a))return true}}},getCrossPoints:function(e,t){var n;var r=[];var i=this.extend(e,t)[0];while(n=i.pop())if(n=n.cross)r.push(n);return r},isSame:function(e,t){var n;var r;var i=e.length;if(i==t.length){for(var s=0;s<i;s++){n=e[s];r=t[s];if(n.nodeX==r.nodeX&&n.nodeY==r.nodeY&&n.forwardX==r.forwardX&&n.forwardX==r.forwardX&&n.backwardX==r.backwardX&&n.backwardX==r.backwardX)return true}}},resetRect:function(e,t,n){var r;var i=.3;if(e.length==4&&t.length==4){for(var s=0;s<4;s++){r=e[s];r.nodeX+=i;r.nodeY+=i;r.forwardX+=i;r.forwardY+=i;r.backwardX+=i;r.backwardY+=i}}},mergeCurves:function(e,t){var n;var r;var i=[];var s=e.pop();while(r=e.pop()){n=this.combineCurves(s,r,t);if(!e.length)return n.concat(i);s=n.pop();i=i.concat(n)}return n.concat(i)},combineCurves:function(e,t,n){var r=this.extend(e,t);e=r[0];t=r[1];if(!e||!t||e.length<2||t.length<2)return;var i;var s;var o;var u;var a;var f;var l;var c;var h=0;var p=[];var d=[];var v;var m;var g;while(h<e.length){s=e[h++];if(s.cross)d.push(s)}if(!d.length){u=this.isInPath(t[0].nodeX,t[0].nodeY,e);a=this.isInPath(e[0].nodeX,e[0].nodeY,t);switch(n){case 3:if(u||a)return[e,t];case 2:if(u)return[t];if(a)return[e];case 1:default:if(u)return[e];if(a)return[t];return[e,t]}return[]}while(d.length){o=[];f=d[0];v=d[0];while(true){if(o.length>1&&(f==v||f==v.cross))break;o.push(f);for(var y=d.length-1;y>=0;y--){s=g?f.cross:f;if(d[y]==s)d.splice(y,1)}s=f[m?"prev":"next"];i=Math.abs(Math.round(s.nodeX)-Math.round(f.nodeX))<3&&Math.abs(Math.round(s.nodeY)-Math.round(f.nodeY))<3?s:this.getBezierObj(m?s:f,m?f:s,.06).point;i=this.isInPath(i.nodeX,i.nodeY,g?e:t);switch(n){case 1:if(i)m=!m;break;case 2:if(!i)m=!m;break;case 3:if(!g&&i||g&&!i)m=!m;break}if(m){f.forwardX=l||f.backwardX;f.forwardY=c||f.backwardY}l=0;c=0;while(f=f[m?"prev":"next"]){if(s=f.cross){g=!g;l=s.backwardX;c=s.backwardY;s.backwardX=f[m?"forwardX":"backwardX"];s.backwardY=f[m?"forwardY":"backwardY"];f=s;break}if(m){u=f.backwardX;f.backwardX=f.forwardX;f.forwardX=u;a=f.backwardY;f.backwardY=f.forwardY;f.forwardY=a}o.push(f);if(o.length>300){alert(Hanimation.Message.BezierError);return[]}}}for(var h=0;h<o.length;h++)delete o[h].cross;p.push(o)}return p}};Mugeda={frameCache:{},data:{},trackHash:{},isSetTrack:false,frameId:0,preview:true,useTouch:false,mapNameId:[],mapIdName:[],frameLength:0,useManul:false,manualControl:false,prevPos:{},mraidState:null,aniData:null,cleanRender:false,emptyImg:"data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",setViewport:function(e,t,n){viewport=document.querySelector("meta[name=viewport]");if(viewport)viewport.setAttribute("content","width="+e)},scanAniData:function(e){var t=e.layers;window.aniLayers=t;this.aniLayers=t;for(var n=t.length-1;n>=0;n--){var r=t[n].units;for(var i=0;i<r.length;i++){var s=r[i].objects;for(var o=0;o<s.length;o++){var u=s[o];if(u.param.action=="behavior"&&u.param.behavior)Mugeda.manualControl=true}}}},updateViewport:function(e){var t=function(){function n(){var e=document,t=e.createElement("div");t.style.height="2500px";e.body.insertBefore(t,e.body.firstChild);var n=e.documentElement.clientHeight>2400;e.body.removeChild(t);return n}var e=document.documentElement,t=e&&e.clientHeight===0;if(typeof document.clientWidth=="number"){return function(){return{width:document.clientWidth,height:document.clientHeight}}}else if(t||n()){var r=document.body;return function(){return{width:r.clientWidth,height:r.clientHeight}}}else{return function(){return{width:e.clientWidth,height:e.clientHeight}}}}();var n=this.aniData;var r=t();var i=n.width/n.height;var s=r.width/r.height;if(i>s){Mugeda.setViewport(n.width,n.height)}else{var o=Math.floor(r.width*n.height/r.height);Mugeda.setViewport(o,r.height)}},removeIdName:function(e,t){var n=Mugeda.mapIdName[e];var r=Mugeda.mapNameId[t];if(r)delete Mugeda.mapNameId[t];if(n)delete Mugeda.mapIdName[e]},setIdName:function(e,t,n){if(!(e&&t&&t.length>0))return;var r=e.guid;var i=0;var s=this.mapIdName[r];var o=this.mapNameId[t];if(o==undefined){if(t!=s){this.mapNameId[t]=r;this.mapIdName[r]=t;if(s)delete this.mapNameId[s]}}else if(n==1){var u=t.split("_");var a=1;if(u.length>1){var f=u[0];var l=parseInt(u[1]);if(isNaN(l)||l<=0)l=1;a=l}else f=t;while(this.mapNameId[f+"_"+a])a++;t=f+"_"+a;this.mapNameId[t]=r;this.mapIdName[r]=t;e.param.name=t}else if(n==2){if(t!=s){this.mapNameId[t]=r;this.mapIdName[r]=t;if(s)delete this.mapNameId[s]}}else i=1;return i},setImageCacheCallback:function(e){Hanimation.ImageCacheCallback=e},setAudioCallback:function(e){Hanimation.AudioCallback=e},setTrackAnchors:function(e){if(this.isSetTrack)return;this.isSetTrack=true;var t=e.trackAnchors||[];var n=Hanimation.MugedaTrackAnchors||[];if(n.length){t=t.concat(n)}if(!t.length)return;var r=document.createElement("div");r.style.display="none";document.body.appendChild(r);var i=guidGen();var s="&urid="+e.urid+"&crid="+e.crid;try{for(var o in t){var u=t[o];var a=u.indexOf("?");if(a<0)u+="?guid="+i+s;else u+="&guid="+i+s;if(u&&!this.trackHash[u]){var f=new Image;f.src=u;r.appendChild(f);this.trackHash[u]=true;f.onerror=function(){f.src=Mugeda.emptyImg}}}}catch(l){}},createclip:function(e,t,n,r){var i=Symbol.getBoundary(t);var s=createNewObject(Hanimation.SHAPE_CLIP);var o=s.dataRef.param;o.symbolId=e.id;o.offsetX=i.left-e.cw/2;o.offsetY=i.top-e.ch/2;o.startX=(n||0)+o.offsetX;o.startY=(r||0)+o.offsetY;o.left=o.startX;o.top=o.startY;o.endX=o.startX+i.width;o.endY=o.startY+i.height;o.right=o.endX;o.bottom=o.endY;o.width=i.width;o.height=i.height;return s},createNewInstance:function(e,t){var t=t||{};var n=Symbol.getSymbolsByName(e);var r=null;if(n&&n.length){var i=n[0];var s=i.layers;var o=Symbol.getLayersObjects(s);var u=Mugeda.createclip(i,o,0,0);var a=u.getParam();t.offsetX=a.offsetX;t.offsetY=a.offsetY;if(!t.above&&!t.below){var f=0;var l=window.currentFrame;var c=this.aniData.layers[f];len=c.units.length;var h=null;var p;var d=null;for(var v=0;v<len;v++){p=c.units[v];if(p&&l>=p.frameStart&&l<p.frameStart+p.frameCount){d=p;break}}if(!d||d.animated){var c=createNewLayer(f,data.layers);d=c.units[0]}TimelineUnit.addObject(d,u)}this.processObjectOptions(u,t);r=u}return r},getLayerObj:function(e,t){var n=null;for(var r=e.length-1;r>=0;r--){if(e[r].id==t){n=e[r];break}}return n},getTimelineUnit:function(e,t,n){var r=null;var i=e.length;var s=Mugeda.getLayerObj(e,t);if(!s||!s.units)return null;i=s.units.length;var o=null;var u;for(var a=0;a<i;a++){u=s.units[a];if(u&&n>=u.frameStart&&n<u.frameStart+u.frameCount){r=u;break}}return r},processObjectOptions:function(e,t){if(!t)return;if(t.above){var n=t.above;var r=n.layerId;var i=n.frameId;var s=Mugeda.getTimelineUnit(this.aniData.layers,r,i);TimelineUnit.addObject(s,e,false,null,n)}else if(t.below){var n=t.above;var r=n.layerId;var i=n.frameId;var s=Mugeda.getTimelineUnit(this.aniData.layers,r,i);TimelineUnit.addObject(s,e,false,null,n)}if(t.rotation!=undefined)e.setRotation(t.rotation);if(t.visible!=undefined)e.setVisible(t.visible);if(t.scaleX!=undefined&&t.scaleY!=undefined)e.setScaleFactor(t.scaleX,t.scaleY);if(t.left!=undefined&&t.top!=undefined){var o=t.positionMode;var u=t.left;var a=t.top;if(o==1){u+=t.offsetX;a+=t.offsetY}e.setPosition(u,a)}},duplicateObjectByName:function(e,t){var n=Mugeda.getObjectByName(e);var r=null;if(n){var i=n.layerId;var s=n.frameId;var o=Mugeda.getTimelineUnit(this.aniData.layers,i,s);var u=n.dataRef;if(u){r=duplicateObject(u,i,s,false,1);if(t.above==undefined){TimelineUnit.addObject(o,r)}this.processObjectOptions(r,t)}}return r},deleteObjectByName:function(e,t){var n=-1;var r=Mugeda.getObjectByName(e);if(r){var i=r.layerId;var s=r.frameId;var o=Mugeda.getTimelineUnit(this.aniData.layers,i,s);if(o){var u=o.objects.length;for(var a=u-1;a>=0;a--){var f=getAniObject(o.objects[a]);if(f==r){Mugeda.removeIdName(o.objects[a].guid,o.objects[a].param.name);o.objects.splice(a,1);n=0;if(o.animated){o.animated=false}break}}}}return n},createUnit:function(e,t,n){var r={id:guidGen(),layerId:e?e:0,frameStart:t?t:0,frameCount:n?n:1,animated:false,visible:true,objects:[],keyframes:[],hashKey:[]};return r},createLayer:function(e){var t=e?e:0;var n={id:t,name:Lang["LayerAttr"]+t,hide:false,lock:false,units:[]};return n},createNewLayer:function(e,t){var n=-1;var e=e?e:0;var t=t?t:window.aniLayers;var r=[n];var i=Mugeda.getFrameLength(t);for(var s=0;s<t.length;s++){r.push(t[s].id)}n=Math.max.apply(Math,r);n++;var o=Mugeda.createLayer(n);var u=Mugeda.createUnit(n);u.frameCount=i;TimelineUnit.addKeyframe(u,u.frameStart);o.units.push(u);if(e){var a=t[e-1];if(a.maskMode!=undefined&&a.maskMode!=0){o.maskMode=2}}t.splice(e,0,o);return o},startAnimation:function(e,t){function c(){if(window.isEnd)return;var t;var o=new Date;var h=o.getTime()-n;var p=true;if(p){t=window.currentFrame;i++;var d=a*i;if(d<h){var v=Math.floor((h-d)/a);i+=v;d+=a*v}var m=d-h;setTimeout(c,m)}else{if(l)l(c);else setTimeout(c,a);t=Math.round(h*u)}if(p||r!=t){if(t>=f){t=f-1}window.currentFrame=t;redrawCanvas({canvas:e,aniData:s,layers:s.layers});Mugeda.postRender();if(window.currentFrame>=f){if(!p){i=0;n=(new Date).getTime()}if(s.loop!==true){window.isPause=true;window.currentFrame=f-1;var g=G("play_and_pause");if(g)g.className="c0"}else window.currentFrame=0}}r=t}var n=new Date;var r=-1;n=n.getTime();var i=0;var e=e;var s=t;this.aniData=t;Mugeda.setTrackAnchors(t);Mugeda.setupInput(t);Mugeda.scanAniData(s);var o=s.script&&s.script.length;var u=.001*s.rate;window.currentFrame=0;var a=1e3/s.rate;var f=this.getFrameLength(s.layers);var l=window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||window.requestAnimationFrame;c()},getEventPosition:function(e,t,n){function r(e){var t={left:e.offsetLeft,top:e.offsetTop};for(;e=e.offsetParent;t.left+=e.offsetLeft-e.scrollLeft,t.top+=e.offsetTop-e.scrollTop);return t}var i;var s;if(t.changedTouches){var o=t.changedTouches[0];if(o==null)return null;i=o.clientX;s=o.clientY}else{i=t.clientX;s=t.clientY}var u=n.offset?n.offset():r(n);var a=i-u.left;var f=s-u.top;var l=a;var c=f;if(e){var h=Zoom.getZoomInfo(e,this.preview?window.currentFrame:-1);if(!this.preview){l+=h.offsetLeft;c+=h.offsetTop}else{l+=h.offsetLeft*h.zoomLevel;c+=h.offsetTop*h.zoomLevel}}return{x:l,y:c,rawX:a,rawY:f}},getCanvas:function(){var e=G("previewCanvas");return e},getObjectByName:function(e,t){var n=this.mapNameId[e];var r=null;if(n)r=getAniObjectById(n);return r},setupInput:function(e,t){function s(t,n,r){function f(e){var t=false;while(e){var n=e.getParam();t=(n.action=="link"||n.action==undefined)&&n.url&&n.url.length||n.action=="form"&&n.form&&n.form.length||n.action=="behavior"&&n.behavior&&n.behavior.length;if(t)break;else e=e.nestedHitObject}return t}var s=Mugeda.getEventPosition(e,n,i);if(!s)return null;var o=Mugeda.prevMode===r&&Mugeda.prevPos.x==s.x&&Mugeda.prevPos.y==s.y;if(o)return null;Mugeda.prevPos.x=s.x;Mugeda.prevPos.y=s.y;var u=Mugeda.hitStartObj?Mugeda.hitStartObj:Mugeda.hitTest(e.layers,-1,window.currentFrame,s.x,s.y,i);if(u)u.position=s;var a="default";t.hitForm=null;t.behavior=null;if(u.object){var l=u.object;var c=getAniObject(l);var h=f(c);if(h)a="pointer";else a="default";var p=window.mugedaObjectHit||window.objectHit;if(p){u.mode=r;u.event=n;u.position=s;p(u,0)}}else if(window.canvasLink||window.canvasForm)a="pointer";else{var p=window.mugedaObjectHit||window.objectHit;if(p){u.mode=r;u.event=n;u.position=s;u.isCanvas=true;p(u,0)}}i.style.cursor=a;return u}function o(t){Mugeda.touchMoved=false;if(window.mugedaInputEvent){var n=Mugeda.getEventPosition(e,t,i);window.mugedaInputEvent(0,t,n)}}function u(t){Mugeda.touchMoved=true;if(window.mugedaInputEvent){var n=Mugeda.getEventPosition(e,t,i);window.mugedaInputEvent(1,t,n)}t.returnValue=false;if(t.preventDefault)t.preventDefault()}function a(t){if(Mugeda.hitStartObj){if(Mugeda.hitStartObj.instance)d.call(Mugeda.hitStartObj.instance,t);Mugeda.hitStartObj=null}else{var n=s(this,t,0);if(n&&n.instance)d.call(n.instance,t)}if(window.mugedaInputEvent){var r=Mugeda.getEventPosition(e,t,i);window.mugedaInputEvent(2,t,r)}if(Mugeda.touchMoved){t.returnValue=false;if(t.preventDefault)t.preventDefault()}}function f(e){{Mugeda.hitMoveObj=s(this,e,1);if(Mugeda.hitMoveObj&&Mugeda.hitMoveObj.instance)d.call(Mugeda.hitMoveObj.instance,e);if(Mugeda.previousHitMoveObj==undefined||Mugeda.hitMoveObj&&Mugeda.hitMoveObj.instance!=Mugeda.previousHitMoveObj.instance){if(Mugeda.previousHitMoveObj&&Mugeda.previousHitMoveObj.instance){var t=document.createEvent("MouseEvents");t.initMouseEvent("mouseout",true,false,window,0,0,0,0,0,false,false,false,false,0,null);d.call(Mugeda.previousHitMoveObj.instance,t)}Mugeda.previousHitMoveObj=Mugeda.hitMoveObj;if(Mugeda.hitMoveObj.instance){var t=document.createEvent("MouseEvents");t.initMouseEvent("mouseover",true,false,window,0,0,0,0,0,false,false,false,false,0,null);d.call(Mugeda.hitMoveObj.instance,t)}}}}function l(e){{Mugeda.hitStartObj=s(this,e,2);Mugeda.hitMoveObj=null;if(Mugeda.hitStartObj&&Mugeda.hitStartObj.instance)d.call(Mugeda.hitStartObj.instance,e)}}function c(e){{var t=s(this,e,0);if(!Mugeda.hitStartObj&&Mugeda.hitMoveObj||Mugeda.hitStartObj&&Mugeda.hitMoveObj&&Mugeda.hitStartObj.object!=Mugeda.hitMoveObj.object)return;if(t&&t.instance)d.call(t.instance,e,"click")}if(t&&t.instance)Mugeda.processObjectBehavior(t.instance,"click");Mugeda.processObjectBehavior(null,"click")}function h(e){var t=s(this,e,0);if(t&&t.instance)d.call(t.instance,e)}function p(e){var t=s(this,e,0);if(t&&t.instance)d.call(t.instance,e)}function d(t,n){var n=n||t.type;if(n=="touchstart")n="mousedown";else if(n=="touchmove")n="mousemove";else if(n=="touchend")n="mouseup";var r=this.eventListeners[n];var s=Mugeda.getEventPosition(e,t,i);if(r){for(var o=0;o<r.length;o++){var u=r[o].call(this,t,s);if(u==false){t.stopPropagation()}}}}if(e.inputHooked)return;var n=navigator.userAgent.match(/iPad/i)!=null;var r=navigator.userAgent.match(/iPhone/i)!=null;this.useTouch=isMobile();var i=G("previewCanvas");window.canvasLink=null;window.canvasForm=null;window.canvasBehavior=null;window.currentFrame=0;if((e.action==undefined||e.action=="link")&&e.url&&e.url.length>0){window.canvasLink=e.url;window.canvasUrlTarget=e.urlTarget}else if(e.action=="form"&&e.form){window.canvasForm=e.form}else if(e.action=="behavior"&&e.behavior){window.canvasBehavior=e.behavior}Mugeda.touchMoved=false;var v=window.navigator.userAgent.indexOf("Android 2.3")>=0;if(Mugeda.useTouch){E(f,"touchmove",i);E(l,"touchstart",i);E(c,v?"click":"touchend",i);E(o,"touchstart",i);E(u,"touchmove",i);E(a,"touchend",i)}else{E(f,"mousemove",i);E(l,"mousedown",i);E(c,"click",i);E(o,"mousedown",i);E(u,"mousemove",i);E(a,"mouseup",i);E(h,"dblclick",i);E(p,"mousewheel",i)}e.inputHooked=true},hitTest:function(e,t,n,r,i,s){var t=t<0?-1:t;var o;var u=0;var a;var f=null;var l=null;var c=Hanimation.HITTEST_NONE;var h=e.length;var p;var d;var v=-1;for(var m=h-1;m>=0;m--){o=e[m];if(t>=0&&t!=o.id)continue;d=o.units.length;for(var g=0;g<d;g++){a=o.units[g];if(!(n>=a.frameStart&&n<a.frameStart+a.frameCount))continue;var y=a.objects;u=y.length;for(var b=u-1;b>=0;b--){if(Math.abs(y[b].param.alpha)<.001)continue;var w=getAniObject(y[b]);c=w?w.hitTest(r,i,8+16):Hanimation.HITTEST_NONE;if(c!=Hanimation.HITTEST_NONE){f=y[b];l=w;v=m;break}}if(f)break}}return{object:f,instance:l,mode:c,layer:v}},onRenderReady:function(e){this.aniData=e;Mugeda.setViewport(e.width,e.height);MugedaMraid.createHTML5VideoTag();if(this.preview&&window.onMugedaRenderReady)window.onMugedaRenderReady();else if(this.preview&&window.onRenderReady)window.onRenderReady()},setFrameout:function(e,t){if(t==0)e.call(this);this.frameOutList=this.frameOutList||[];var n=this.frameOutList,r=n.length;if(r){do{if(n[r-1].frames<=t)break}while(r--)}if(n[r])n[r].frames-=t;if(r)t-=n[r-1].frames;n.splice(r,0,{frames:t,fun:e})},postRender:function(){var e=false;if(this.frameOutList){while(this.frameOutList.length){if(this.frameOutList[0].frames==1){var t=this.frameOutList[0].fun;this.frameOutList.splice(0,1);t.call(this);if(this.frameOutList[0])this.frameOutList[0].frames++}else{this.frameOutList[0].frames--;break}}}if(window.mugedaEnterFrame)e=mugedaEnterFrame(window.currentFrame);else if(window.enterFrame)e=enterFrame(window.currentFrame);if(!window.isPause&&!e)window.currentFrame++},getAnimationLength:function(e){var t=Mugeda.getAnimation(e);if(!t)return 0;if(t.frameLength==undefined)t.frameLength=Mugeda.getFrameLength(t.layers);return t.frameLength},play:function(name,container,cacheMode){var aniData=Mugeda.getAnimation(name);if(!aniData)return false;this.aniData=aniData;if(typeof container=="string")container=G(container);container.innerHTML=""+'<div id="mugeda_outer" style="position:relative;min-width:0;width:'+aniData.width+"px; height:"+aniData.height+'px;">'+'<canvas id="previewCanvas">This text is displayed if your browser does not support HTML5 Canvas.</canvas>'+'<div style="width:0;height:0;overflow:hidden;"><canvas id="canvasBuffer"></canvas></div>'+"</div>";window.currentFrame=0;Mugeda.setTrackAnchors(aniData);Mugeda.setupInput(aniData);var width=aniData.width;var height=aniData.height;var canvas=G("previewCanvas");if(aniData.color)canvas.style.backgroundColor=aniData.color;if(aniData.image){canvas.style.backgroundPosition="center";canvas.style.backgroundRepeat="no-repeat";canvas.style.backgroundSize="100% 100%";canvas.style.backgroundImage="url("+aniData.image+")"}if(aniData.width){canvas.width=width;canvas.style.width=container.style.width=width+"px"}if(aniData.height){canvas.height=height;canvas.style.height=container.style.height=height+"px"}if(!aniData.zoomInfo||!aniData.zoomInfo[0])aniData.zoomInfo=[{zoomLevel:1,offsetLeft:0,offsetTop:0,rotation:0}];var len=this.getAnimationLength(name);this.canvas=canvas;window.aniData=aniData;AudioCache.init(aniData,function(errorCount){ImageCache.init(aniData,function(errorCount){aniData.layers=buildLayers(aniData.layers);Symbol.build(aniData.symbols,function(){try{eval(aniData.script||"")}catch(e){console&&console.log((e.lineNumber||e.line)+": "+e)}Mugeda.onRenderReady(aniData);var ctx=canvas.getContext("2d");if(false){redrawCanvas({canvas:canvas,aniData:aniData,layers:aniData.layers})}else{gotoAndPlay=function(e){currentFrame=Math.max(0,e-1)};var timerSpan=1e3/aniData.rate;var mo=setInterval(function(){if(window.isEnd)return;try{redrawCanvas({canvas:canvas,aniData:aniData,layers:aniData.layers})}catch(e){}Mugeda.postRender();if(currentFrame>=len){if(aniData.loop!==true){currentFrame=len-1;window.isPause=true}else currentFrame=0}},timerSpan)}})})});return true},getImage:function(e,t){t=t||1;var n=this.getAnimationLength(e);if(t>n)t%=n;window.currentFrame=t-1;redrawCanvas({canvas:this.canvas,aniData:this.aniData,repair:true});var r=G("previewCanvas").toDataURL("image/png");var i=new Image;i.src=r;return i},exportImage:function(e,t){var n=this.getImage(e,10);window.open(n.src)},zipAniData:function(e){return compressAniData(e)},unzipAniData:function(e){return uncompressAniData(e)},getAnimation:function(e){var t=null;if(typeof e=="string")t=Mugeda.data[e];if(t){if(t.vr&&t.vr>500){t=uncompressAniData(t);Mugeda.data[e]=t}else if(!t.isunzip&&t.version&&t.version<510){HaniData.unzip(t);t.frameLength=Mugeda.getFrameLength(t.layers);t.isunzip=true}}return t},getCacheFrame:function(e,t){return this.frameCache[e+"_"+t]},setCacheFrame:function(e,t,n){this.frameCache[e+"_"+t]=n},cacheAnimation:function(e,t){var n=this.getAnimation(e);var r=null;var i={buildCache:true,frameCallback:function(e,n){if(t){if(t(n)==true){clearInterval(r)}}},finishCallback:function(e,n){clearInterval(r);if(t)t(n,true)}};ImageCache.init(n,function(){n.layers=buildLayers(n.layers);Symbol.build(n.symbols,function(){window.preload=true;r=setInterval(function(){Mugeda.playFrame(null,e,i)},1)})})},clearCache:function(e){var t=this.frameCache||{};for(var n in t){if(n.split("_")[0]==e){delete t[n];t[n]=null}}},playFrame:function(e,t,n){function d(e,t,n){var r=n;var i=r.sourceX||0;var o=r.sourceY||0;var u=r.sourceW||s.width;var a=r.sourceH||s.height;var f=r.targetX||0;var l=r.targetY||0;var c=r.targetW||u;var h=r.targetH||a;var p=r.flipHorizontal?c:0;var d=r.flipVertical?h:0;var v=r.flipHorizontal?-1:1;var m=r.flipVertical?-1:1;e.save();if(n.clearBack)e.clearRect(f,l,c,h);e.translate(f,l);if(n.flipHorizontal||n.flipVertical){e.translate(p,d);e.scale(v,m)}e.drawImage(t,i,o,u,a,0,0,c,h);e.restore()}function v(o){try{var u;if(!c)u=Mugeda.getCacheFrame(t,l);if(!u){redrawCanvas({canvas:s,aniData:r,repair:true,frameId:l,silent:true});if(o){u=new Image;u.src=s.toDataURL("image/png");if(e){u.onload=function(){d(e,this,n)}}if(c!=1)Mugeda.setCacheFrame(t,l,u)}else d(e,s,n)}else{if(e){d(e,u,n)}}}catch(a){}if(i.frameCallback)i.frameCallback(r,l);if(h&&i.finishCallback)i.finishCallback(r,l)}var r=this.getAnimation(t);if(!r.zoomInfo||!r.zoomInfo[0])r.zoomInfo=[{zoomLevel:1,offsetLeft:0,offsetTop:0,rotation:0}];if(!n)n={};var i=n;var s=r.cacheCanvas;if(!s){var o=document.createElement("div");o.innerHTML="<canvas></canvas>";o.style.overflow="hidden";o.style.width=0;o.style.height=0;document.body.appendChild(o);s=o.childNodes[0];s.width=r.width||600;s.height=r.height||400;r.color="transparent";r.cacheCanvas=s}var u=r.layers;if(r.frameLength==undefined)r.frameLength=Mugeda.getFrameLength(u);var a=this.getAnimationLength(t);var f=i.previous;if(i.loop!=undefined)r.loop=i.loop;if(i.frameNo==undefined){if(i.frameId==undefined)i.frameId=0;else i.frameId=i.frameId+(f?-1:1)}else i.frameId=i.frameNo;if(i.frameId==a)i.frameId=0;else if(i.frameId==-1)i.frameId=a-1;var l=i.frameId;var c=i.cacheMode||0;var h=l==a-1;var p=i.clearBack;if(!window.preload){ImageCache.init(r,function(){r.layers=buildLayers(r.layers);Symbol.build(r.symbols,function(){window.preload=true;v(n.buildCache)})})}else v(n.buildCache)},getFrameLength:function(e){var t=1;for(var n=e.length-1;n>=0;n--){var r=e[n];var i=r.units.length;for(var s=0;s<i;s++){var o=r.units[s];var u=o.frameStart+o.frameCount;if(t<u)t=u}}return t},loadAudio:function(e){var t=document.createElement("audio");t.setAttribute("src",e);t.load();return t},gotoAndPlay:function(e){this.manualControl=true;window.currentFrame=Math.max(0,e-1);Mugeda.resume()},gotoAndPause:function(e){this.manualControl=true;window.currentFrame=Math.max(0,e-1);Mugeda.pause()},next:function(){this.manualControl=true;window.currentFrame++;Mugeda.pause()},previous:function(){this.manualControl=true;window.currentFrame--;if(window.currentFrame<0)window.currentFrame=0;Mugeda.pause()},pause:function(){this.manualControl=true;window.isEnd=false;window.isPause=true},resume:function(e){var e=e==undefined?0:e;window.currentFrame+=e;if(window.currentFrame<0)window.currentFrame=0;this.manualControl=true;window.isEnd=false;window.isPause=false},playAndPause:function(e){window.isEnd=false;window.isPause=!window.isPause;if(e)e.className=window.isPause?"c0":"c1"},processBehaviors:function(e,t,n){var r=t.length;for(var i=0;i<r;i++){var s=t[i];if(s.event==n){s.object=e;MugedaBehavior.processAction(s,n,n=="click"?true:false)}}},processObjectBehavior:function(e,t){if(e&&e.nestedHitObject)this.processObjectBehavior(e.nestedHitObject,t);{var n,r,i,s;if(e){var o=e.getParam();if((o.action=="link"||o.action==undefined)&&o.url&&o.url.length){n=o.url;r=o.urlTarget}else if(o.action=="form"&&o.form&&o.form.length)i=o.form;else if(o.action=="behavior"&&o.behavior&&o.behavior.length)s=o.behavior}else{n=window.canvasLink;r=window.canvasUrlTarget;i=window.canvasForm;s=window.canvasBehavior}if(e&&n&&t=="click"){MugedaMraid.openLink(n,r)}else if(i&&t=="click"){i=JSON.parse(i);if(i){MugedaBehavior.popupForm(i)}}else if(s){behaviors=JSON.parse(s);Mugeda.processBehaviors(e,behaviors,t)}if(!e&&n&&t=="click")MugedaMraid.openLink(window.canvasLink,window.canvasUrlTarget)}},attachPopup:function(e){var t=arguments.callee;var n=t.pop;if(!n){n=document.createElement("div");n.className="mugeda_pop";n.innerHTML=""+"<style>"+".mugeda_pop{position:absolute;bottom:0;width:100%;height:0;overflow:hidden;}"+".mugeda_pop .x{display:block;position:absolute;right:5px;top:5px;width:23px;height:23px;background-image:url(res/player_close.png);}"+".mugeda_pop ul,.mugeda_pop ul{margin:0;padding:0;list-style:none;}"+".mugeda_pop ul{height:64px;background:rgba(0,0,0,0.6);margin:0 auto;}"+".mugeda_pop ul li{float:left;width:64px;height:64px;overflow:hidden;}"+".mugeda_pop ul li a{display:block;width:60px;height:60px;margin:2px;background-image:url(res/player.png);}"+".mugeda_pop ul li a:hover{background-color:rgba(0,0,0,0.6);}"+".mugeda_pop ul li a.c0{background-position:0 0;}"+".mugeda_pop ul li a.c1{background-position:-60px 0;}"+".mugeda_pop ul li a.c2{background-position:-120px 0;}"+".mugeda_pop ul li a.c3{background-position:-180px 0;}"+".mugeda_pop ul li a.c4{background-position:-240px 0;}"+".mugeda_pop ul li a.c5{background-position:-300px 0;}"+"</style>"+"<ul>"+'<li><a class="c1" target="_blank" href="#" onclick="Mugeda.playAndPause(this);return false" id="play_and_pause"></a></li>'+'<li><a class="c2" target="_blank" href="http://www.facebook.com/" onclick="Mugeda.exportImage();return false"></a></li>'+'<li><a class="c3" target="_blank" href="http://www.twitter.com/"></a></li>'+'<li><a class="c4" target="_blank" href="http://www.google.com/"></a></li>'+'<li><a class="c5" target="_blank" href="http://www.mugeda.com/"></a></li>'+"</ul>"+'<a class="x" href="" onclick="Mugeda.attachPopup.toggle(true);return false"></a>';t.pop=n;t.toggle=function(e){clearInterval(n.mo);n.mo=setInterval(function(){var t=n.offsetHeight+(e?-4:4);var r=e?t<0:t>64;if(r){clearInterval(n.mo);return}n.style.height=t+"px"},10)};if(!e)e=document.body;if(e.tagName=="DIV")e.style.position="relative";e.appendChild(n)}t.toggle()},getCachedImageData:function(e){var t=ObjectCache.getCache(e);return t},serialize:function(e){if(!e||!e.length)return"";var t="";for(var n=0;n<e.length;n++){var r=e[n];if(r&&r.name)t+="&"+r.name+"="+encodeURIComponent(r.value||"")}return t.substr(1)}};MugedaCompress={keys:["Ac","action","fM","form","tt","title","wt","width","ht","height","cl","color","sm","symbols","ly","layers","vr","version","sC","scripts","zI","zoomInfo","pd","pid","tp","type","nm","name","un","units","lI","layerId","fS","frameStart","fC","frameCount","ad","animated","vb","visible","ob","objects","pm","param","fI","fillInfo","cv","curve","kf","keyframes","md","mode","tw","tween","hK","hashKey","ix","index","rW","rawWidth","rH","rawHeight","sI","symbolId","oX","offsetX","oY","offsetY","rX","rotateCenterX","rY","rotateCenterY","it","items","nI","nodeId","gP","guidPath","ph","path","gi","guid","sm","smooth","iX","innerX","iY","innerY","uX","outerX","uY","outerY","cX","centerX","cY","centerY","ed","edges","st","section","fZ","fontSize","fT","fontStyle","fW","fontWeight","fF","fontFamily","tA","textAlign","tC","textContent","tD","textDecoration","cR","cornerRadius","iS","imageSrc","lC","lineCap","lJ","LineJoin","fR","frameRate","iP","innerPercent","TA","trackAnchors","MT","mugedaTrackAnchors"],zip:function(e){if(!e)return;if(e.zip)return e;var t=JSON.parse(JSON.stringify(e));t.zip=1;if(t.rate==12)delete t.rate;if(t.width==600)delete t.width;if(t.height==400)delete t.height;if(t.guid=="")delete t.guid;if(t.title=="")delete t.title;if(t.script=="")delete t.script;if(t.loop==true)delete t.loop;if(t.useCamera==false)delete t.useCamera;if(t.symbols.length==0)delete t.symbols;else{var n=t.symbols;for(var r=0;r<n.length;r++){var i=n[r];delete i.runtime;delete i.dirtyFlag;this.zipLayers(i.layers)}}this.zipZoomInfo(t);this.zipLayers(t.layers);t=this.zipKey(t);return t},unzip:function(e){if(!e)return e;if(e.zip!=1)return HaniData.unzip(e);var t=JSON.parse(JSON.stringify(e));t=this.unzipKey(t);delete t.zip;if(t.rate==undefined)t.rate=12;if(t.width==undefined)t.width=600;if(t.height==undefined)t.height=400;if(t.guid==undefined)t.guid="";if(t.title==undefined)t.title="";if(t.script==undefined)t.script="";if(t.loop==undefined)t.loop=true;if(t.useCamera==undefined)t.useCamera=false;if(t.symbols==undefined)t.symbols=[];if(t.symbols.length){var n=t.symbols;for(var r=0;r<n.length;r++){var i=n[r];i.runtime=true;i.dirtyFlag=false;this.unzipLayers(i.layers)}}this.unzipZoomInfo(t);this.unzipLayers(t.layers);return t},zipKey:function(data){var reg;data=JSON.stringify(data);for(var i=0;i<this.keys.length;i+=2){reg=eval('/"'+this.keys[i+1]+'":/g');data=data.replace(reg,'"'+this.keys[i]+'":')}return JSON.parse(data)},unzipKey:function(data){var reg;data=JSON.stringify(data);for(var i=0;i<this.keys.length;i+=2){reg=eval('/"'+this.keys[i]+'":/g');data=data.replace(reg,'"'+this.keys[i+1]+'":')}return JSON.parse(data)},zipZoomInfo:function(e){var t=[];var n=e.zoomInfo||[];for(var r=0;r<n.length;r++){var i=n[r];if(i)t.push("i"+r);else continue;if(i.tween)t.push("t"+i.tween);t.push(i.offsetLeft);t.push(i.offsetTop);t.push(i.rotation);t.push(i.zoomLevel)}e.zoomInfo=t.join(",")},unzipZoomInfo:function(e){var t=[];var n=e.zoomInfo.split(",")||[];for(var r=0;r<n.length;r+=4){var i=n[r];if(i.indexOf("i")==0){i=i.substr(1);r++;var s=n[r];if(s.indexOf("t")==0){s=s.substr(1);r++}else s=null;t[i]={offsetLeft:Number(n[r]),offsetTop:Number(n[r+1]),rotation:Number(n[r+2]),zoomLevel:Number(n[r+3])};if(s)t[i].tween=s}}e.zoomInfo=t},zipLayers:function(e){for(var t=0;t<e.length;t++){var n=e[t];delete n.hide;delete n.lock;var r=n.units;for(var i=0;i<r.length;i++){var s=r[i];if(s.animated){this.zipPath(s)}else{}var o=s.keyframes||[];for(var u=0;u<o.length;u++){var a=o[u].param;this.zipParam(a);if(a.behavior)delete a.behavior;if(a.action)delete a.action}if(s.visible==true)delete s.visible;this.zipObjects(s.objects)}}},unzipLayers:function(e){for(var t=0;t<e.length;t++){var n=e[t];n.hide=false;n.lock=false;var r=n.units;for(var i=0;i<r.length;i++){var s=r[i];if(s.animated){this.unzipPath(s)}else{}var o=s.keyframes||[];for(var u=0;u<o.length;u++){var a=o[u].param;this.unzipParam(a)}if(s.visible==undefined)s.visible=true;this.unzipObjects(s.objects)}}},zipPath:function(e){var t=[];var n=e.path||[];var r=e.pathLeft||0;var i=e.pathTop||0;t.push(r);t.push(i);for(var s=0;s<n.length;s++){var o=n[s];t.push(o.id);t.push(o.backwardX);t.push(o.backwardY);t.push(o.forwardX);t.push(o.forwardY);t.push(o.nodeX);t.push(o.nodeY)}e.path=t.join(",");delete e.pathLeft;delete e.pathTop},unzipPath:function(e){var t=e.path.split(",");var n=[];var r=t.shift();var i=t.shift();for(var s=0;s<t.length;s+=7){n.push({id:Number(t[s]),backwardX:Number(t[s+1]),backwardY:Number(t[s+2]),forwardX:Number(t[s+3]),forwardY:Number(t[s+4]),nodeX:Number(t[s+5]),nodeY:Number(t[s+6])})}if(n.length){e.pathLeft=Number(r);e.pathTop=Number(i);e.path=n}else{delete e.path;delete e.pathLeft;delete e.pathTop}},zipObjects:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.items&&n.items.length){this.zipObjects(n.items)}else{delete n.id;delete n.name;delete n.items;delete n.aryAnchors}this.zipCurve(n);this.zipParam(n.param)}},unzipObjects:function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.items&&n.items.length){this.unzipObjects(n.items)}else{n.id=0;n.name="";n.items=[];n.aryAnchors=[]}this.unzipCurve(n);this.unzipParam(n.param)}},zipCurve:function(e){var t=e.curve.points;if(typeof t=="string"){var n=t.split(";");t=[];for(var r=0;r<n.length;r++){var i=n[r].split(",");t.push({backwardX:Number(i[0]),backwardY:Number(i[1]),forwardX:Number(i[2]),forwardY:Number(i[3]),nodeX:Number(i[4]),nodeY:Number(i[5])})}}var s=[];s.push(e.curve.closed?1:0);for(var r=0;r<t.length;r++){var i=t[r];s.push(i.backwardX);s.push(i.backwardY);s.push(i.forwardX);s.push(i.forwardY);s.push(i.nodeX);s.push(i.nodeY)}e.curve=s.join(",")},unzipCurve:function(e){var t=e.curve;if(typeof t!="string")return;e.curve={};var n=t.split(",");var r=n.shift()==1;e.curve.closed=r;var i=[];for(var s=0;s<n.length;s+=6){i.push({backwardX:Number(n[s]),backwardY:Number(n[s+1]),forwardX:Number(n[s+2]),forwardY:Number(n[s+3]),nodeX:Number(n[s+4]),nodeY:Number(n[s+5])})}e.curve.points=i},zipParam:function(e){var t=["L"+e.left,"R"+e.right,"T"+e.top,"B"+e.bottom,"X"+e.scaleX,"Y"+e.scaleY,"O"+e.rotate,"W"+e.lineWidth,"A"+e.alpha,"C"+e.strokeColor];if(Math.abs(e.left-e.startX)>.001)t.push("S"+e.startX);if(Math.abs(e.top-e.startY)>.001)t.push("P"+e.startY);if(Math.abs(e.right-e.endX)>.001)t.push("E"+e.endX);if(Math.abs(e.bottom-e.endY)>.001)t.push("N"+e.endY);e.m=t.join(";");if(e.strokeType==0)delete e.strokeType;if(e.frameRate==12)delete e.frameRate;if(e.lineCap=="round")delete e.lineCap;if(e.lineJoin=="round")delete e.lineJoin;if(!e.customPivot)delete e.customPivot;delete e.startX;delete e.startY;delete e.endX;delete e.endY;delete e.width;delete e.height;delete e.left;delete e.right;delete e.top;delete e.bottom;delete e.scaleX;delete e.scaleY;delete e.rotate;delete e.lineWidth;delete e.alpha;delete e.strokeColor;this.zipFillInfo(e)},unzipParam:function(e){if(e.strokeType==undefined)e.strokeType=0;if(e.frameRate==undefined)e.frameRate=12;if(e.lineCap==undefined)e.lineCap="round";if(e.lineJoin==undefined)e.lineJoin="round";var t=e.m.split(";");for(var n=0;n<t.length;n++){var r=t[n].substr(0,1);var i=t[n].substr(1);switch(r){case"L":e.left=Number(i);break;case"R":e.right=Number(i);break;case"T":e.top=Number(i);break;case"B":e.bottom=Number(i);break;case"S":e.startX=Number(i);break;case"P":e.startY=Number(i);break;case"E":e.endX=Number(i);break;case"N":e.endY=Number(i);break;case"X":e.scaleX=Number(i);break;case"Y":e.scaleY=Number(i);break;case"O":e.rotate=Number(i);break;case"W":e.lineWidth=Number(i);break;case"A":e.alpha=Number(i);break;case"C":e.strokeColor=i;break}}if(e.startX==undefined)e.startX=e.left;if(e.startY==undefined)e.startY=e.top;if(e.endX==undefined)e.endX=e.right;if(e.endY==undefined)e.endY=e.bottom;e.width=e.right-e.left;e.height=e.bottom-e.top;delete e.m;this.unzipFillInfo(e)},zipFillInfo:function(e){var t=[];var n=[];var r=e.fillInfo;if(!r)return;var i=r.fillStyle;var s=r.fillColors;var o=[r.fillStartPos.x,r.fillStartPos.y,r.fillEndPos.x,r.fillEndPos.y];var u=r.fillImage;if(u!=""){i=-1;s.length=0;o=[]}if(i==0){s.length=1;o=[]}t.push(i);for(var a=0;a<s.length;a++){var f=s[a];n.push(f.p);n.push(f.r);n.push(f.g);n.push(f.b);n.push(f.a)}t.push(n.join(","));t.push(o.join(","));t.push(u);e.fillInfo=t.join(";")},unzipFillInfo:function(e){if(!e.fillInfo)return;var t=e.fillInfo.split(";");var n=Number(t[0]);var r=t[1].split(",");var i=t[3];var s=[];for(var o=0;o<r.length;o+=5){s.push({p:Number(r[o]),r:Number(r[o+1]),g:Number(r[o+2]),b:Number(r[o+3]),a:Number(r[o+4])})}var u={fillStyle:n,fillImage:i,fillColors:s};var a=t[2].split(",");if(a.length!=4)a=[0,0,0,0];u.fillStartPos={x:Number(a[0]),y:Number(a[1])};u.fillEndPos={x:Number(a[2]),y:Number(a[3])};e.fillInfo=u}}
